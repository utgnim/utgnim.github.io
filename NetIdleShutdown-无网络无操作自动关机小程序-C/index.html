<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>NetIdleShutdown æ— ç½‘ç»œæ— æ“ä½œè‡ªåŠ¨å…³æœºå°ç¨‹åº[C#] | It's a blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>// åŸå§‹ä»£ç ï¼šè¯»å–ç³»ç»Ÿæ·±è‰²æ¨¡å¼åå¥½
// var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');

// æœ€å°åŒ–ä¿®æ”¹ï¼šä¸è¯»å–ç³»ç»Ÿåå¥½ï¼Œå¼ºåˆ¶é»˜è®¤æ·±è‰²æ¨¡å¼
// é€ ä¸€ä¸ªå‡çš„å¯¹è±¡ï¼Œè®© prefersDarkMode.matches æ°¸è¿œä¸º true
var prefersDarkMode = { matches: true };

// è·å–åˆ‡æ¢æŒ‰é’®
var toggle = document.querySelector('.darkmode-toggle');

// è·å– <html> å…ƒç´ ï¼Œç”¨äºè®¾ç½® data-dark å±æ€§
var html = document.querySelector('html');

// åˆå§‹åŒ–æš—è‰²æ¨¡å¼ï¼š
// ä¼˜å…ˆä½¿ç”¨ localStorage.darkï¼ˆç”¨æˆ·ä¸Šæ¬¡é€‰æ‹©ï¼‰
// å¦‚æœæ²¡æœ‰è®°å½•ï¼Œåˆ™ä½¿ç”¨ prefersDarkMode.matchesï¼ˆç°åœ¨æ°¸è¿œä¸º trueï¼‰
html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

// ç‚¹å‡»æŒ‰é’®æ—¶åˆ‡æ¢æš—è‰²æ¨¡å¼
toggle.addEventListener('click', () => {
  // å½“å‰çŠ¶æ€å–åï¼Œå¹¶å†™å…¥ localStorage
  localStorage.dark = !(html.dataset.dark == 'true');

  // åŒæ­¥åˆ° <html> çš„ data-dark å±æ€§
  html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">NetIdleShutdown æ— ç½‘ç»œæ— æ“ä½œè‡ªåŠ¨å…³æœºå°ç¨‹åº[C#]</h1><a id="logo" href="/.">It's a blog</a><p class="description">Mingtu's äºŒä¸‰äº‹ï¼</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a><a href="/../"><i class="fa fa-ban"> Galgame</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">NetIdleShutdown æ— ç½‘ç»œæ— æ“ä½œè‡ªåŠ¨å…³æœºå°ç¨‹åº[C#]</h1><div class="post-meta">2026-02-13<span> | </span><span class="category"><a href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.9k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 22</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><div class="post-content"><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿œç¨‹æ“æ§ä½äºå®¶ä¸­çš„ç”µè„‘æ—¶ï¼Œå¶å°”ä¼šé‡åˆ°è·¯ç”±å™¨æˆ–å…‰çŒ«å½“æœºçš„æƒ…å†µï¼Œç½‘ç»œçªç„¶æ–­å¼€ï¼Œç”µè„‘å´è¿˜æ²¡å…³æœºï¼Œåªèƒ½ç­‰å¾…ä¸‹æ¬¡æ–­ç”µè·¯ç”±å™¨æˆ–å…‰çŒ«é‡å¯æ‰èƒ½é‡æ–°è¿æ¥ä¸Šç”µè„‘ï¼Œè¿™å°±éå¸¸è€—ç”µï¼Œäºæ˜¯æœ‰äº†è¿™ä¸ªå°å·¥å…·ï¼</p>
<h2 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h2><p>ç”±äºæœ¬äººååˆ†çš„èœï¼Œå°½ç®¡ä¹Ÿæ›¾æ†§æ†¬è¿‡æˆä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œä½†ä¸€ç›´ä¸‰åˆ†çƒ­åº¦ã€åŠé€”è€ŒåºŸï¼Œåˆ°æœ€åä¸äº†äº†ä¹‹ã€‚æ‰€ä»¥ä½ å¯ä»¥çŒœåˆ°ä»£ç å¹¶ä¸æ˜¯æˆ‘å†™çš„ã€‚</p>
<p>ä»£ç ç”± Gemini æä¾›æ€è·¯ï¼ŒDeepSeek å†™æˆï¼Œç»å†äº†å¤§çº¦ä¸‰å¤©çš„æ—¶é—´ï¼ŒæœŸé—´ä¸æ–­çš„è¯· AI ä¿®æ”¹ã€ç¼–è¯‘ï¼Œæ‰‹åŠ¨æµ‹è¯•ï¼Œæœ€åç»ˆäºèƒ½å¤ŸæˆåŠŸè¿è¡Œã€‚ç»åˆæ­¥çŸ­æœŸæµ‹è¯•ï¼Œåº”è¯¥æ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ï¼Œæ•…åˆ†äº«å‡ºæ¥ï¼Œä»£ç <code>NetIdleShutdown.cs</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Net.NetworkInformation;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Concurrent;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">NetIdleShutdown</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> ç½‘ç»œç©ºé—²å…³æœºç¨‹åº</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> ä¸»è¦åŠŸèƒ½ï¼š</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 1. æ£€æµ‹ç½‘ç»œè¿æ¥çŠ¶æ€ï¼ˆåŒé‡æ£€æµ‹ï¼šPing + HTTPï¼‰</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 2. æ£€æµ‹ç”¨æˆ·æ´»åŠ¨çŠ¶æ€</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 3. å½“ç½‘ç»œæ–­å¼€ä¸”ç”¨æˆ·æ— æ“ä½œæ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œå…³æœºæ“ä½œ</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> æ£€æµ‹é€»è¾‘ï¼š</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - ä½¿ç”¨å¹¶è¡Œçº¿ç¨‹åŒæ—¶æ£€æµ‹å¤šä¸ªç›®æ ‡ï¼Œæé«˜æ£€æµ‹é€Ÿåº¦</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - å¦‚æœæ‰€æœ‰Pingç›®æ ‡éƒ½å¤±è´¥ï¼Œåˆ™ç›´æ¥åˆ¤æ–­ä¸ºç½‘ç»œç¦»çº¿</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - å¦‚æœæœ‰è‡³å°‘ä¸€ä¸ªPingæˆåŠŸï¼Œåˆ™ç»§ç»­è¿›è¡ŒHTTPæ£€æµ‹</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - å¿…é¡»åŒæ—¶æ»¡è¶³Pingå’ŒHTTPæ£€æµ‹éƒ½è‡³å°‘æœ‰ä¸€ä¸ªæˆåŠŸï¼Œæ‰åˆ¤æ–­ä¸ºåœ¨çº¿</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> é…ç½®è¯´æ˜ï¼š</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - ç¨‹åºé»˜è®¤é…ç½®åœ¨AppConfigç±»ä¸­</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - å¯ä¿®æ”¹é»˜è®¤å€¼æˆ–é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥è‡ªå®šä¹‰é…ç½®</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NetIdleShutdown</span> : <span class="title">IDisposable</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> é…ç½®ç±»</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> åº”ç”¨ç¨‹åºé…ç½®ç±»</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> åŒ…å«æ‰€æœ‰å¯é…ç½®çš„å‚æ•°å’Œæ£€æµ‹ç›®æ ‡åˆ—è¡¨</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AppConfig</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// æ ¸å¿ƒé…ç½®å‚æ•°</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> MaxNoNetMinutes = <span class="number">3</span>;           <span class="comment">// æ— ç½‘ç»œå¤šå°‘åˆ†é’Ÿåå…³æœº</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> PingTimeoutMs = <span class="number">1500</span>;          <span class="comment">// Pingè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰- æ§åˆ¶çº¿ç¨‹ç­‰å¾…æ—¶é—´</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> HttpTimeoutMs = <span class="number">5000</span>;          <span class="comment">// HTTPè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰- æ§åˆ¶çº¿ç¨‹ç­‰å¾…æ—¶é—´</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> CheckIntervalSeconds = <span class="number">60</span>;     <span class="comment">// æ£€æµ‹é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰- ä¸»å¾ªç¯ç­‰å¾…æ—¶é—´</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> UserIdleThresholdSeconds = <span class="number">60</span>; <span class="comment">// ç”¨æˆ·ç©ºé—²æ—¶é—´é˜ˆå€¼ï¼ˆç§’ï¼‰- åˆ¤å®šç”¨æˆ·æ— æ´»åŠ¨çš„é˜ˆå€¼</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ£€æµ‹ç›®æ ‡åˆ—è¡¨</span></span><br><span class="line">            <span class="keyword">public</span> List&lt;<span class="built_in">string</span>&gt; PingTargets;  <span class="comment">// Pingæ£€æµ‹ç›®æ ‡IPåœ°å€åˆ—è¡¨</span></span><br><span class="line">            <span class="keyword">public</span> List&lt;<span class="built_in">string</span>&gt; HttpTargets;  <span class="comment">// HTTPæ£€æµ‹ç›®æ ‡URLåˆ—è¡¨</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">            <span class="comment"><span class="doctag">///</span> æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–é»˜è®¤é…ç½®å’Œæ£€æµ‹ç›®æ ‡</span></span><br><span class="line">            <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">AppConfig</span>()</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// åˆå§‹åŒ–Pingæ£€æµ‹ç›®æ ‡åˆ—è¡¨</span></span><br><span class="line">                <span class="comment">// åŒ…å«å›½å†…å¤–å¸¸ç”¨çš„å…¬å…±DNSæœåŠ¡å™¨ï¼Œæé«˜æ£€æµ‹å¯é æ€§</span></span><br><span class="line">                PingTargets = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;223.5.5.5&quot;</span>,        <span class="comment">// é˜¿é‡ŒDNS - å›½å†…å¸¸ç”¨</span></span><br><span class="line">                    <span class="string">&quot;119.29.29.29&quot;</span>,     <span class="comment">// è…¾è®¯DNS - å›½å†…å¸¸ç”¨</span></span><br><span class="line">                    <span class="string">&quot;180.76.76.76&quot;</span>,     <span class="comment">// ç™¾åº¦DNS - å›½å†…å¸¸ç”¨</span></span><br><span class="line">                    <span class="string">&quot;1.1.1.1&quot;</span>,          <span class="comment">// Cloudflare DNS - å›½é™…å¸¸ç”¨</span></span><br><span class="line">                    <span class="string">&quot;8.8.8.8&quot;</span>,          <span class="comment">// Google DNS - å›½é™…å¸¸ç”¨</span></span><br><span class="line">                    <span class="string">&quot;114.114.114.114&quot;</span>,  <span class="comment">// 114DNS - å›½å†…å¸¸ç”¨</span></span><br><span class="line">                    <span class="string">&quot;208.67.222.222&quot;</span>,   <span class="comment">// OpenDNS - å›½é™…å¤‡ç”¨</span></span><br><span class="line">                    <span class="string">&quot;9.9.9.9&quot;</span>           <span class="comment">// Quad9 DNS - å›½é™…å¤‡ç”¨</span></span><br><span class="line">                &#125;;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// åˆå§‹åŒ–HTTPæ£€æµ‹ç›®æ ‡åˆ—è¡¨</span></span><br><span class="line">                <span class="comment">// ä½¿ç”¨å„å¤§å…¬å¸çš„ç½‘ç»œè¿é€šæ€§æ£€æµ‹æœåŠ¡ï¼Œé€šå¸¸è¿”å›204çŠ¶æ€ç </span></span><br><span class="line">                HttpTargets = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;http://connect.rom.miui.com/generate_204&quot;</span>,          <span class="comment">// å°ç±³ç½‘ç»œæ£€æµ‹æœåŠ¡</span></span><br><span class="line">                    <span class="string">&quot;http://connectivitycheck.gstatic.com/generate_204&quot;</span>, <span class="comment">// Googleç½‘ç»œæ£€æµ‹æœåŠ¡</span></span><br><span class="line">                    <span class="string">&quot;http://www.gstatic.com/generate_204&quot;</span>,               <span class="comment">// Googleå¤‡ç”¨æ£€æµ‹æœåŠ¡</span></span><br><span class="line">                    <span class="string">&quot;http://www.msftncsi.com/ncsi.txt&quot;</span>,                  <span class="comment">// Microsoftç½‘ç»œæ£€æµ‹æœåŠ¡</span></span><br><span class="line">                    <span class="string">&quot;http://captive.apple.com/hotspot-detect.html&quot;</span>,      <span class="comment">// Appleç½‘ç»œæ£€æµ‹æœåŠ¡</span></span><br><span class="line">                    <span class="string">&quot;http://connectivitycheck.platform.hicloud.com/generate_204&quot;</span> <span class="comment">// åä¸ºç½‘ç»œæ£€æµ‹æœåŠ¡</span></span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> Windows APIå£°æ˜</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è·å–ç³»ç»Ÿæœ€åè¾“å…¥æ—¶é—´çš„Windows APIå‡½æ•°</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ç”¨äºæ£€æµ‹ç”¨æˆ·æ´»åŠ¨çŠ¶æ€</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;plii&quot;&gt;</span>LASTINPUTINFOç»“æ„ä½“å¼•ç”¨<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>è·å–æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;user32.dll&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">GetLastInputInfo</span>(<span class="params"><span class="keyword">ref</span> LASTINPUTINFO plii</span>)</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æœ€åè¾“å…¥ä¿¡æ¯ç»“æ„ä½“</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ç”¨äºå­˜å‚¨ç”¨æˆ·æœ€åè¾“å…¥çš„æ—¶é—´ä¿¡æ¯</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">StructLayout(LayoutKind.Sequential)</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">struct</span> LASTINPUTINFO</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">uint</span> cbSize;    <span class="comment">// ç»“æ„ä½“å¤§å°</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">uint</span> dwTime;    <span class="comment">// æœ€åè¾“å…¥æ—¶é—´ï¼ˆç³»ç»Ÿå¯åŠ¨åçš„æ¯«ç§’æ•°ï¼‰</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> ç§æœ‰å­—æ®µ</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> AppConfig _config;                <span class="comment">// ç¨‹åºé…ç½®å®ä¾‹</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> _noNetCounter = <span class="number">0</span>;                     <span class="comment">// æ— ç½‘ç»œè®¡æ•°å™¨</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">bool</span> _isRunning = <span class="literal">true</span>;                    <span class="comment">// ç¨‹åºè¿è¡Œæ ‡å¿—</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">object</span> _counterLock = <span class="keyword">new</span> <span class="built_in">object</span>(); <span class="comment">// è®¡æ•°å™¨åŒæ­¥é”</span></span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;config&quot;&gt;</span>è‡ªå®šä¹‰é…ç½®ï¼Œå¦‚æœä¸ºnullåˆ™ä½¿ç”¨é»˜è®¤é…ç½®<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">NetIdleShutdown</span>(<span class="params">AppConfig config = <span class="literal">null</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ä¼ å…¥çš„é…ç½®æˆ–åˆ›å»ºé»˜è®¤é…ç½®</span></span><br><span class="line">            _config = config ?? <span class="keyword">new</span> AppConfig();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®°å½•é…ç½®ä¿¡æ¯</span></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[SYSTEM] ç¨‹åºé…ç½®å·²åŠ è½½&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[SYSTEM] æ— ç½‘ç»œå…³æœºé˜ˆå€¼: &quot;</span> + _config.MaxNoNetMinutes + <span class="string">&quot; åˆ†é’Ÿ&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[SYSTEM] æ£€æµ‹é—´éš”: &quot;</span> + _config.CheckIntervalSeconds + <span class="string">&quot; ç§’&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[SYSTEM] ç”¨æˆ·ç©ºé—²é˜ˆå€¼: &quot;</span> + _config.UserIdleThresholdSeconds + <span class="string">&quot; ç§’&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> ä¸»ç¨‹åºå…¥å£</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å¯åŠ¨ç½‘ç»œå®ˆæŠ¤ç¨‹åºä¸»å¾ªç¯</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Run</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// æ˜¾ç¤ºç¨‹åºæ ‡é¢˜å’Œé…ç½®ä¿¡æ¯</span></span><br><span class="line">                PrintBanner();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// ä¸»å¾ªç¯ï¼šæŒç»­æ£€æµ‹ç½‘ç»œå’Œç”¨æˆ·çŠ¶æ€</span></span><br><span class="line">                <span class="keyword">while</span> (_isRunning)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// æ‰§è¡Œä¸€æ¬¡å®Œæ•´çš„æ£€æµ‹å‘¨æœŸ</span></span><br><span class="line">                    PerformCheckCycle();</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// ç­‰å¾…æŒ‡å®šçš„é—´éš”æ—¶é—´ï¼Œæ¯ç§’æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦åœæ­¢</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; _config.CheckIntervalSeconds &amp;&amp; _isRunning; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// è®°å½•ä¸¥é‡é”™è¯¯å¹¶é‡æ–°æŠ›å‡º</span></span><br><span class="line">                LogError(<span class="string">&quot;ç¨‹åºè¿è¡Œå¼‚å¸¸&quot;</span>, ex);</span><br><span class="line">                <span class="keyword">throw</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> åœæ­¢å®ˆæŠ¤ç¨‹åº</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è®¾ç½®è¿è¡Œæ ‡å¿—ä¸ºfalseï¼Œä½¿ä¸»å¾ªç¯é€€å‡º</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Stop</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            _isRunning = <span class="literal">false</span>;</span><br><span class="line">            LogInfo(<span class="string">&quot;ç¨‹åºå·²æ”¶åˆ°åœæ­¢æŒ‡ä»¤&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> æ£€æµ‹å‘¨æœŸ</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ‰§è¡Œä¸€ä¸ªå®Œæ•´çš„æ£€æµ‹å‘¨æœŸ</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> åŒ…æ‹¬ç½‘ç»œæ£€æµ‹ã€ç”¨æˆ·æ´»åŠ¨æ£€æµ‹å’ŒçŠ¶æ€å¤„ç†</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PerformCheckCycle</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> timestamp = DateTime.Now;</span><br><span class="line">            LogInfo(<span class="string">&quot;å¼€å§‹ç¬¬ &quot;</span> + (_noNetCounter + <span class="number">1</span>) + <span class="string">&quot; æ¬¡æ£€æµ‹&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ£€æµ‹ç½‘ç»œè¿æ¥çŠ¶æ€</span></span><br><span class="line">            <span class="built_in">bool</span> isOnline = CheckConnectivity();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ ¹æ®ç½‘ç»œçŠ¶æ€è¿›è¡Œç›¸åº”å¤„ç†</span></span><br><span class="line">            <span class="keyword">if</span> (isOnline)</span><br><span class="line">            &#123;</span><br><span class="line">                HandleOnlineStatus(timestamp);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                HandleOfflineStatus(timestamp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å¤„ç†åœ¨çº¿çŠ¶æ€</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ç½‘ç»œæ­£å¸¸æ—¶é‡ç½®è®¡æ•°å™¨å¹¶è®°å½•çŠ¶æ€</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;timestamp&quot;&gt;</span>æ£€æµ‹æ—¶é—´æˆ³<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HandleOnlineStatus</span>(<span class="params">DateTime timestamp</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">lock</span> (_counterLock)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœä¹‹å‰æœ‰ç¦»çº¿è®°å½•ï¼Œåˆ™é‡ç½®è®¡æ•°å™¨</span></span><br><span class="line">                <span class="keyword">if</span> (_noNetCounter &gt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    LogInfo(<span class="string">&quot;ç½‘ç»œæ¢å¤æ­£å¸¸ï¼Œæ— ç½‘ç»œè®¡æ•°å™¨å·²é‡ç½®&quot;</span>);</span><br><span class="line">                    _noNetCounter = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            LogInfo(<span class="string">&quot;ç½‘ç»œçŠ¶æ€: åœ¨çº¿&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å¤„ç†ç¦»çº¿çŠ¶æ€</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ç½‘ç»œæ–­å¼€æ—¶æ£€æŸ¥ç”¨æˆ·æ´»åŠ¨å¹¶æ›´æ–°è®¡æ•°å™¨</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;timestamp&quot;&gt;</span>æ£€æµ‹æ—¶é—´æˆ³<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HandleOfflineStatus</span>(<span class="params">DateTime timestamp</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// æ£€æµ‹ç”¨æˆ·æ˜¯å¦æœ‰è¾“å…¥æ´»åŠ¨</span></span><br><span class="line">            <span class="built_in">bool</span> hasUserActivity = HasUserInputActivity();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (hasUserActivity)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// æœ‰ç”¨æˆ·æ´»åŠ¨ï¼Œé‡ç½®è®¡æ•°å™¨</span></span><br><span class="line">                <span class="keyword">lock</span> (_counterLock)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (_noNetCounter &gt; <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        LogInfo(<span class="string">&quot;æ£€æµ‹åˆ°ç”¨æˆ·æ´»åŠ¨ï¼Œæ— ç½‘ç»œè®¡æ•°å™¨å·²é‡ç½®&quot;</span>);</span><br><span class="line">                        _noNetCounter = <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                LogInfo(<span class="string">&quot;ç½‘ç»œçŠ¶æ€: ç¦»çº¿ (ç”¨æˆ·æ´»åŠ¨ä¸­ï¼Œä¸è®¡æ•°)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// æ— ç”¨æˆ·æ´»åŠ¨ï¼Œå¢åŠ è®¡æ•°å™¨</span></span><br><span class="line">                <span class="keyword">lock</span> (_counterLock)</span><br><span class="line">                &#123;</span><br><span class="line">                    _noNetCounter++;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                LogInfo(<span class="string">&quot;ç½‘ç»œçŠ¶æ€: ç¦»çº¿&quot;</span>);</span><br><span class="line">                LogInfo(<span class="string">&quot;æ— ç½‘ç»œè®¡æ•°å™¨: &quot;</span> + _noNetCounter + <span class="string">&quot;/&quot;</span> + _config.MaxNoNetMinutes);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æ£€æŸ¥æ˜¯å¦è¾¾åˆ°å…³æœºæ¡ä»¶</span></span><br><span class="line">                <span class="keyword">if</span> (_noNetCounter &gt;= _config.MaxNoNetMinutes)</span><br><span class="line">                &#123;</span><br><span class="line">                    ExecuteShutdown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> ç½‘ç»œæ£€æµ‹</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ£€æµ‹ç½‘ç»œè¿æ¥çŠ¶æ€</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ£€æµ‹é€»è¾‘ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. å¹¶è¡Œæ‰§è¡ŒPingæ£€æµ‹</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. å¦‚æœæ‰€æœ‰Pingç›®æ ‡éƒ½å¤±è´¥ï¼Œç›´æ¥åˆ¤æ–­ä¸ºç¦»çº¿</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªPingæˆåŠŸï¼Œåˆ™ç»§ç»­è¿›è¡ŒHTTPæ£€æµ‹</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 4. å¿…é¡»åŒæ—¶æ»¡è¶³Pingå’ŒHTTPæ£€æµ‹éƒ½è‡³å°‘æœ‰ä¸€ä¸ªæˆåŠŸï¼Œæ‰åˆ¤æ–­ä¸ºåœ¨çº¿</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ä¼˜åŒ–ï¼šç½‘ç»œå®Œå…¨æ–­å¼€æ—¶ï¼Œæœ€å¿«800mså³å¯åˆ¤æ–­ä¸ºç¦»çº¿</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>trueè¡¨ç¤ºç½‘ç»œåœ¨çº¿ï¼Œfalseè¡¨ç¤ºç½‘ç»œç¦»çº¿<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">CheckConnectivity</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            LogInfo(<span class="string">&quot;å¼€å§‹ç½‘ç»œè¿é€šæ€§æ£€æµ‹&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ç¬¬ä¸€æ­¥ï¼šå¹¶è¡Œæ‰§è¡ŒPingæ£€æµ‹</span></span><br><span class="line">            <span class="built_in">bool</span> pingSuccess = PerformPingTestsParallel();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ç¬¬äºŒæ­¥ï¼šå¦‚æœPingæ£€æµ‹å…¨éƒ¨å¤±è´¥ï¼Œç›´æ¥åˆ¤æ–­ä¸ºç¦»çº¿</span></span><br><span class="line">            <span class="keyword">if</span> (!pingSuccess)</span><br><span class="line">            &#123;</span><br><span class="line">                LogInfo(<span class="string">&quot;Pingæ£€æµ‹ç»“æœ: å…¨éƒ¨å¤±è´¥ï¼Œç›´æ¥åˆ¤å®šä¸ºç½‘ç»œç¦»çº¿&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ç¬¬ä¸‰æ­¥ï¼šPingæ£€æµ‹é€šè¿‡ï¼Œç»§ç»­è¿›è¡ŒHTTPæ£€æµ‹</span></span><br><span class="line">            LogInfo(<span class="string">&quot;Pingæ£€æµ‹ç»“æœ: è‡³å°‘æœ‰ä¸€ä¸ªæˆåŠŸï¼Œå¼€å§‹HTTPæ£€æµ‹&quot;</span>);</span><br><span class="line">            <span class="built_in">bool</span> httpSuccess = PerformHttpTestsParallel();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ç¬¬å››æ­¥ï¼šå¿…é¡»åŒæ—¶æ»¡è¶³Pingå’ŒHTTPæ£€æµ‹éƒ½æˆåŠŸ</span></span><br><span class="line">            <span class="built_in">bool</span> finalResult = pingSuccess &amp;&amp; httpSuccess;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®°å½•è¯¦ç»†æ£€æµ‹ç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span> (finalResult)</span><br><span class="line">            &#123;</span><br><span class="line">                LogInfo(<span class="string">&quot;ç½‘ç»œæ£€æµ‹æœ€ç»ˆç»“æœ: åœ¨çº¿ (Pingå’ŒHTTPæ£€æµ‹å‡é€šè¿‡)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                LogInfo(<span class="string">&quot;ç½‘ç»œæ£€æµ‹æœ€ç»ˆç»“æœ: ç¦»çº¿ (Ping: &quot;</span> + (pingSuccess ? <span class="string">&quot;æˆåŠŸ&quot;</span> : <span class="string">&quot;å¤±è´¥&quot;</span>) + </span><br><span class="line">                       <span class="string">&quot;, HTTP: &quot;</span> + (httpSuccess ? <span class="string">&quot;æˆåŠŸ&quot;</span> : <span class="string">&quot;å¤±è´¥&quot;</span>) + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> finalResult;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å¹¶è¡Œæ‰§è¡ŒPingæµ‹è¯•</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å®ç°æ–¹å¼ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. ä¸ºæ¯ä¸ªPingç›®æ ‡åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. æ‰€æœ‰çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæé«˜æ£€æµ‹é€Ÿåº¦</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. ä½¿ç”¨ConcurrentDictionaryå­˜å‚¨çº¿ç¨‹å®‰å…¨çš„ç»“æœ</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 4. ä½¿ç”¨Interlocked.Incrementä¿è¯è®¡æ•°å™¨çš„çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è¶…æ—¶æ§åˆ¶ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ¯ä¸ªçº¿ç¨‹æœ€å¤šç­‰å¾…PingTimeoutMsæ¯«ç§’</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è¶…æ—¶çº¿ç¨‹å°†è¢«å¼ºåˆ¶ç»ˆæ­¢</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>trueè¡¨ç¤ºè‡³å°‘æœ‰ä¸€ä¸ªPingæˆåŠŸï¼Œfalseè¡¨ç¤ºå…¨éƒ¨å¤±è´¥<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">PerformPingTestsParallel</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            LogInfo(<span class="string">&quot;å¼€å§‹å¹¶è¡ŒPingæµ‹è¯• (ç›®æ ‡æ•°: &quot;</span> + _config.PingTargets.Count + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">int</span> successCount = <span class="number">0</span>;  <span class="comment">// æˆåŠŸè®¡æ•°å™¨</span></span><br><span class="line">            <span class="keyword">var</span> results = <span class="keyword">new</span> ConcurrentDictionary&lt;<span class="built_in">string</span>, <span class="built_in">bool</span>&gt;();  <span class="comment">// ç»“æœå­˜å‚¨</span></span><br><span class="line">            <span class="keyword">var</span> tasks = <span class="keyword">new</span> List&lt;Thread&gt;();  <span class="comment">// çº¿ç¨‹åˆ—è¡¨</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ä¸ºæ¯ä¸ªPingç›®æ ‡åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> target <span class="keyword">in</span> _config.PingTargets)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> thread = <span class="keyword">new</span> Thread(() =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">bool</span> result = PingHostFast(target);</span><br><span class="line">                    results[target] = result;</span><br><span class="line">                    <span class="keyword">if</span> (result)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Interlocked.Increment(<span class="keyword">ref</span> successCount);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">                thread.Start();</span><br><span class="line">                tasks.Add(thread);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆï¼Œæœ€å¤šç­‰å¾…PingTimeoutMsæ¯«ç§’</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> thread <span class="keyword">in</span> tasks)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!thread.Join(_config.PingTimeoutMs))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// çº¿ç¨‹è¶…æ—¶ï¼Œå¼ºåˆ¶ç»ˆæ­¢</span></span><br><span class="line">                    thread.Abort();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è¾“å‡ºPingæµ‹è¯•è¯¦ç»†ç»“æœ</span></span><br><span class="line">            <span class="keyword">var</span> resultBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            resultBuilder.AppendLine(<span class="string">&quot;PINGæ£€æµ‹è¯¦ç»†ç»“æœ:&quot;</span>);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> target <span class="keyword">in</span> _config.PingTargets)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">bool</span> result;</span><br><span class="line">                <span class="keyword">if</span> (results.TryGetValue(target, <span class="keyword">out</span> result))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">string</span> status = result ? <span class="string">&quot;æˆåŠŸ&quot;</span> : <span class="string">&quot;å¤±è´¥&quot;</span>;</span><br><span class="line">                    resultBuilder.AppendLine(<span class="string">&quot;  &quot;</span> + target.PadRight(<span class="number">15</span>) + <span class="string">&quot; =&gt; &quot;</span> + status);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    resultBuilder.AppendLine(<span class="string">&quot;  &quot;</span> + target.PadRight(<span class="number">15</span>) + <span class="string">&quot; =&gt; è¶…æ—¶&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            LogInfo(resultBuilder.ToString());</span><br><span class="line">            LogInfo(<span class="string">&quot;PINGæ£€æµ‹ç»Ÿè®¡: æˆåŠŸ &quot;</span> + successCount + <span class="string">&quot;/&quot;</span> + _config.PingTargets.Count);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> successCount &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å¹¶è¡Œæ‰§è¡ŒHTTPæµ‹è¯•</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ£€æµ‹åŸç†ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ä½¿ç”¨HTTP HEADæ–¹æ³•è¯·æ±‚ç½‘ç»œè¿é€šæ€§æ£€æµ‹æœåŠ¡</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è¿™äº›æœåŠ¡é€šå¸¸è¿”å›204çŠ¶æ€ç æˆ–2xxçŠ¶æ€ç </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> åªè¦è¿”å›2xxçŠ¶æ€ç å°±è®¤ä¸ºæˆåŠŸ</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>trueè¡¨ç¤ºè‡³å°‘æœ‰ä¸€ä¸ªHTTPè¯·æ±‚æˆåŠŸï¼Œfalseè¡¨ç¤ºå…¨éƒ¨å¤±è´¥<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">PerformHttpTestsParallel</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            LogInfo(<span class="string">&quot;å¼€å§‹å¹¶è¡ŒHTTPæµ‹è¯• (ç›®æ ‡æ•°: &quot;</span> + _config.HttpTargets.Count + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">int</span> successCount = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">var</span> results = <span class="keyword">new</span> ConcurrentDictionary&lt;<span class="built_in">string</span>, <span class="built_in">bool</span>&gt;();</span><br><span class="line">            <span class="keyword">var</span> tasks = <span class="keyword">new</span> List&lt;Thread&gt;();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ä¸ºæ¯ä¸ªHTTPç›®æ ‡åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> url <span class="keyword">in</span> _config.HttpTargets)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> thread = <span class="keyword">new</span> Thread(() =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">bool</span> result = TestHttpConnectionFast(url);</span><br><span class="line">                    results[url] = result;</span><br><span class="line">                    <span class="keyword">if</span> (result)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Interlocked.Increment(<span class="keyword">ref</span> successCount);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">                thread.Start();</span><br><span class="line">                tasks.Add(thread);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆï¼Œæœ€å¤šç­‰å¾…HttpTimeoutMsæ¯«ç§’</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> thread <span class="keyword">in</span> tasks)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!thread.Join(_config.HttpTimeoutMs))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// çº¿ç¨‹è¶…æ—¶ï¼Œå¼ºåˆ¶ç»ˆæ­¢</span></span><br><span class="line">                    thread.Abort();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è¾“å‡ºHTTPæµ‹è¯•è¯¦ç»†ç»“æœ</span></span><br><span class="line">            <span class="keyword">var</span> resultBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            resultBuilder.AppendLine(<span class="string">&quot;HTTPæ£€æµ‹è¯¦ç»†ç»“æœ:&quot;</span>);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> url <span class="keyword">in</span> _config.HttpTargets)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">bool</span> result;</span><br><span class="line">                <span class="keyword">if</span> (results.TryGetValue(url, <span class="keyword">out</span> result))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">string</span> status = result ? <span class="string">&quot;æˆåŠŸ&quot;</span> : <span class="string">&quot;å¤±è´¥&quot;</span>;</span><br><span class="line">                    resultBuilder.AppendLine(<span class="string">&quot;  &quot;</span> + url + <span class="string">&quot; =&gt; &quot;</span> + status);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    resultBuilder.AppendLine(<span class="string">&quot;  &quot;</span> + url + <span class="string">&quot; =&gt; è¶…æ—¶&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            LogInfo(resultBuilder.ToString());</span><br><span class="line">            LogInfo(<span class="string">&quot;HTTPæ£€æµ‹ç»Ÿè®¡: æˆåŠŸ &quot;</span> + successCount + <span class="string">&quot;/&quot;</span> + _config.HttpTargets.Count);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> successCount &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å¿«é€ŸPingå•ä¸ªä¸»æœº</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ä¼˜åŒ–ç‚¹ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. ä½¿ç”¨è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´(800ms)åŠ å¿«æ£€æµ‹é€Ÿåº¦</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. æ¯æ¬¡åˆ›å»ºæ–°çš„Pingå®ä¾‹ï¼Œé¿å…èµ„æºç«äº‰</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. ç®€åŒ–å¼‚å¸¸å¤„ç†ï¼Œåªè¿”å›æˆåŠŸ/å¤±è´¥</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;host&quot;&gt;</span>ç›®æ ‡ä¸»æœºIPåœ°å€<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>trueè¡¨ç¤ºPingæˆåŠŸï¼Œfalseè¡¨ç¤ºå¤±è´¥æˆ–è¶…æ—¶<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">PingHostFast</span>(<span class="params"><span class="built_in">string</span> host</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">var</span> ping = <span class="keyword">new</span> Ping())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// ä½¿ç”¨è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´åŠ å¿«æ£€æµ‹é€Ÿåº¦</span></span><br><span class="line">                    <span class="keyword">var</span> reply = ping.Send(host, <span class="number">800</span>);</span><br><span class="line">                    <span class="keyword">return</span> reply != <span class="literal">null</span> &amp;&amp; reply.Status == IPStatus.Success;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// å‘ç”Ÿä»»ä½•å¼‚å¸¸éƒ½è§†ä¸ºå¤±è´¥</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å¿«é€Ÿæµ‹è¯•HTTPè¿æ¥</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æŠ€æœ¯è¦ç‚¹ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. ä½¿ç”¨HEADæ–¹æ³•ï¼Œåªè·å–å“åº”å¤´ï¼Œä¸ä¸‹è½½å†…å®¹</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. è®¾ç½®è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´(2000ms)åŠ å¿«æ£€æµ‹é€Ÿåº¦</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. è®¾ç½®åˆé€‚çš„User-Agentï¼Œé¿å…è¢«æŸäº›æœåŠ¡æ‹’ç»</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 4. å…³é—­KeepAliveï¼Œé¿å…è¿æ¥æ± å½±å“</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;url&quot;&gt;</span>ç›®æ ‡URLåœ°å€<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>trueè¡¨ç¤ºHTTPè¯·æ±‚æˆåŠŸï¼Œfalseè¡¨ç¤ºå¤±è´¥æˆ–è¶…æ—¶<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">TestHttpConnectionFast</span>(<span class="params"><span class="built_in">string</span> url</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// åˆ›å»ºHTTPè¯·æ±‚</span></span><br><span class="line">                <span class="keyword">var</span> request = WebRequest.Create(url) <span class="keyword">as</span> HttpWebRequest;</span><br><span class="line">                <span class="keyword">if</span> (request == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// é…ç½®è¯·æ±‚å‚æ•°</span></span><br><span class="line">                request.Timeout = <span class="number">2000</span>;  <span class="comment">// 2ç§’è¶…æ—¶</span></span><br><span class="line">                request.Method = <span class="string">&quot;HEAD&quot;</span>; <span class="comment">// ä½¿ç”¨HEADæ–¹æ³•</span></span><br><span class="line">                request.UserAgent = <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span>;</span><br><span class="line">                request.Accept = <span class="string">&quot;*/*&quot;</span>;</span><br><span class="line">                request.KeepAlive = <span class="literal">false</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// å‘é€è¯·æ±‚å¹¶è·å–å“åº”</span></span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">var</span> response = request.GetResponse() <span class="keyword">as</span> HttpWebResponse)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (response != <span class="literal">null</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 2xxçŠ¶æ€ç éƒ½è§†ä¸ºæˆåŠŸ</span></span><br><span class="line">                        <span class="keyword">return</span> (<span class="built_in">int</span>)response.StatusCode &gt;= <span class="number">200</span> &amp;&amp; (<span class="built_in">int</span>)response.StatusCode &lt;= <span class="number">299</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (WebException ex)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// WebExceptionç‰¹æ®Šå¤„ç†ï¼šå°è¯•è·å–å“åº”çŠ¶æ€ç </span></span><br><span class="line">                <span class="keyword">if</span> (ex.Response != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">using</span> (<span class="keyword">var</span> response = ex.Response <span class="keyword">as</span> HttpWebResponse)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (response != <span class="literal">null</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// å³ä½¿å‘ç”ŸWebExceptionï¼Œå¦‚æœè¿”å›2xxçŠ¶æ€ç ä¹Ÿç®—æˆåŠŸ</span></span><br><span class="line">                            <span class="keyword">return</span> (<span class="built_in">int</span>)response.StatusCode &gt;= <span class="number">200</span> &amp;&amp; (<span class="built_in">int</span>)response.StatusCode &lt;= <span class="number">299</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// å…¶ä»–å¼‚å¸¸éƒ½è§†ä¸ºå¤±è´¥</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> ç”¨æˆ·æ´»åŠ¨æ£€æµ‹</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ£€æµ‹ç”¨æˆ·è¾“å…¥æ´»åŠ¨</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ£€æµ‹åŸç†ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. é€šè¿‡Windows APIè·å–ç³»ç»Ÿæœ€åè¾“å…¥æ—¶é—´</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. è®¡ç®—å½“å‰æ—¶é—´ä¸æœ€åè¾“å…¥æ—¶é—´çš„å·®å€¼</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. å¦‚æœå·®å€¼å°äºé˜ˆå€¼ï¼Œåˆ™è®¤ä¸ºç”¨æˆ·æœ‰æ´»åŠ¨</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ³¨æ„ï¼šåªæ£€æµ‹é”®ç›˜å’Œé¼ æ ‡è¾“å…¥æ´»åŠ¨</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>trueè¡¨ç¤ºç”¨æˆ·æœ‰è¾“å…¥æ´»åŠ¨ï¼Œfalseè¡¨ç¤ºç”¨æˆ·ç©ºé—²<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">HasUserInputActivity</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">uint</span> idleTimeMs = GetUserIdleTime();</span><br><span class="line">                <span class="built_in">uint</span> thresholdMs = (<span class="built_in">uint</span>)_config.UserIdleThresholdSeconds * <span class="number">1000</span>;</span><br><span class="line">                <span class="built_in">bool</span> hasActivity = idleTimeMs &lt; thresholdMs;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// è®°å½•è¯¦ç»†çš„ç©ºé—²æ—¶é—´ä¿¡æ¯</span></span><br><span class="line">                LogInfo(<span class="string">&quot;ç”¨æˆ·æ´»åŠ¨æ£€æµ‹: &quot;</span> + (hasActivity ? <span class="string">&quot;æœ‰æ´»åŠ¨&quot;</span> : <span class="string">&quot;æ— æ´»åŠ¨&quot;</span>) + </span><br><span class="line">                       <span class="string">&quot; (ç©ºé—²æ—¶é—´: &quot;</span> + (idleTimeMs / <span class="number">1000</span>) + <span class="string">&quot; ç§’)&quot;</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> hasActivity;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// ç”¨æˆ·æ´»åŠ¨æ£€æµ‹å¤±è´¥æ—¶ï¼Œé»˜è®¤è¿”å›æ— æ´»åŠ¨ï¼ˆä¿å®ˆç­–ç•¥ï¼‰</span></span><br><span class="line">                LogError(<span class="string">&quot;ç”¨æˆ·æ´»åŠ¨æ£€æµ‹å¼‚å¸¸&quot;</span>, ex);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è·å–ç”¨æˆ·ç©ºé—²æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å®ç°æ–¹å¼ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. è°ƒç”¨GetLastInputInfoè·å–ç³»ç»Ÿæœ€åè¾“å…¥æ—¶é—´</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. è®¡ç®—å½“å‰ç³»ç»Ÿè¿è¡Œæ—¶é—´ä¸æœ€åè¾“å…¥æ—¶é—´çš„å·®å€¼</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. è¿”å›ç”¨æˆ·ç©ºé—²çš„æ¯«ç§’æ•°</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ³¨æ„ï¼šEnvironment.TickCountåœ¨49.7å¤©åä¼šå›ç»•ï¼Œä½†è¿™é‡Œå½±å“ä¸å¤§</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>ç”¨æˆ·ç©ºé—²æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">uint</span> <span class="title">GetUserIdleTime</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> lastInputInfo = <span class="keyword">new</span> LASTINPUTINFO();</span><br><span class="line">            lastInputInfo.cbSize = (<span class="built_in">uint</span>)Marshal.SizeOf(lastInputInfo);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (GetLastInputInfo(<span class="keyword">ref</span> lastInputInfo))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// è®¡ç®—ç©ºé—²æ—¶é—´ = å½“å‰æ—¶é—´ - æœ€åè¾“å…¥æ—¶é—´</span></span><br><span class="line">                <span class="keyword">return</span> (<span class="built_in">uint</span>)Environment.TickCount - lastInputInfo.dwTime;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// APIè°ƒç”¨å¤±è´¥æ—¶è¿”å›æœ€å¤§å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·å·²é•¿æ—¶é—´ç©ºé—²</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">uint</span>.MaxValue;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> å…³æœºæ“ä½œ</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ‰§è¡Œå…³æœºæ“ä½œ</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ‰§è¡Œæ­¥éª¤ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. æ£€æŸ¥ç®¡ç†å‘˜æƒé™</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. ä½¿ç”¨shutdown.exeæ‰§è¡Œå…³æœºå‘½ä»¤</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. è®¾ç½®ç«‹å³å…³æœº(/s /f /t 0)</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> /s: å…³æœº</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> /f: å¼ºåˆ¶å…³é—­æ‰€æœ‰åº”ç”¨ç¨‹åº</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> /t 0: å»¶è¿Ÿ0ç§’</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ExecuteShutdown</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                LogWarning(<span class="string">&quot;å·²è¾¾åˆ°å…³æœºæ¡ä»¶ï¼Œå‡†å¤‡æ‰§è¡Œå…³æœºæ“ä½œ&quot;</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æƒé™æ£€æŸ¥ï¼šå…³æœºéœ€è¦ç®¡ç†å‘˜æƒé™</span></span><br><span class="line">                <span class="keyword">if</span> (!IsRunningAsAdministrator())</span><br><span class="line">                &#123;</span><br><span class="line">                    LogError(<span class="string">&quot;æ‰§è¡Œå…³æœºæ“ä½œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œè¯·ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œæœ¬ç¨‹åº&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// é…ç½®å…³æœºå‘½ä»¤å‚æ•°</span></span><br><span class="line">                <span class="keyword">var</span> psi = <span class="keyword">new</span> ProcessStartInfo</span><br><span class="line">                &#123;</span><br><span class="line">                    FileName = <span class="string">&quot;shutdown.exe&quot;</span>,</span><br><span class="line">                    Arguments = <span class="string">&quot;/s /f /t 0&quot;</span>,</span><br><span class="line">                    CreateNoWindow = <span class="literal">true</span>,</span><br><span class="line">                    UseShellExecute = <span class="literal">false</span></span><br><span class="line">                &#125;;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æ‰§è¡Œå…³æœºå‘½ä»¤</span></span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">var</span> process = Process.Start(psi))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// ç­‰å¾…å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">                    Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                LogWarning(<span class="string">&quot;å…³æœºå‘½ä»¤å·²å‘é€ï¼Œç³»ç»Ÿå°†ç«‹å³å…³é—­&quot;</span>);</span><br><span class="line">                Stop(); <span class="comment">// åœæ­¢ç¨‹åºä¸»å¾ªç¯</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                LogError(<span class="string">&quot;æ‰§è¡Œå…³æœºæ“ä½œå¤±è´¥&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ£€æŸ¥æ˜¯å¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å®ç°æ–¹å¼ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. è·å–å½“å‰Windowsèº«ä»½æ ‡è¯†</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. æ£€æŸ¥æ˜¯å¦å±äºAdministratorsç»„</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ³¨æ„ï¼šWindows VistaåŠä»¥ä¸Šç‰ˆæœ¬éœ€è¦UACæå‡</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>trueè¡¨ç¤ºä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œfalseè¡¨ç¤ºä¸æ˜¯ç®¡ç†å‘˜<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">IsRunningAsAdministrator</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> identity = System.Security.Principal.WindowsIdentity.GetCurrent();</span><br><span class="line">                <span class="keyword">var</span> principal = <span class="keyword">new</span> System.Security.Principal.WindowsPrincipal(identity);</span><br><span class="line">                <span class="keyword">return</span> principal.IsInRole(System.Security.Principal.WindowsBuiltInRole.Administrator);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// æƒé™æ£€æŸ¥å¤±è´¥æ—¶ï¼Œé»˜è®¤è¿”å›falseï¼ˆä¿å®ˆç­–ç•¥ï¼‰</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> æ—¥å¿—è¾“å‡º</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è¾“å‡ºç¨‹åºæ ‡é¢˜å’Œé…ç½®ä¿¡æ¯</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PrintBanner</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ç½‘ç»œç©ºé—²å…³æœºç¨‹åº - NetIdleShutdown&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ç‰ˆæœ¬: 1.0&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ä½œè€…: System&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;åŠŸèƒ½è¯´æ˜:&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- å½“ç½‘ç»œæ–­å¼€ä¸”ç”¨æˆ·æ— æ“ä½œæ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œå…³æœº&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- æ£€æµ‹ç­–ç•¥: åŒé‡æ£€æµ‹ (Ping + HTTP)&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- æ£€æµ‹æ–¹å¼: å¹¶è¡Œå¤šçº¿ç¨‹æ£€æµ‹&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;å½“å‰é…ç½®:&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- æ— ç½‘ç»œå…³æœºé˜ˆå€¼: &quot;</span> + _config.MaxNoNetMinutes + <span class="string">&quot; åˆ†é’Ÿ&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- æ£€æµ‹é—´éš”: &quot;</span> + _config.CheckIntervalSeconds + <span class="string">&quot; ç§’&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- ç”¨æˆ·ç©ºé—²é˜ˆå€¼: &quot;</span> + _config.UserIdleThresholdSeconds + <span class="string">&quot; ç§’&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- Pingæ£€æµ‹ç›®æ ‡: &quot;</span> + _config.PingTargets.Count + <span class="string">&quot; ä¸ª&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- HTTPæ£€æµ‹ç›®æ ‡: &quot;</span> + _config.HttpTargets.Count + <span class="string">&quot; ä¸ª&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è®°å½•ä¿¡æ¯çº§åˆ«æ—¥å¿—</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ç”¨äºè®°å½•ç¨‹åºæ­£å¸¸è¿è¡ŒçŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;message&quot;&gt;</span>æ—¥å¿—æ¶ˆæ¯<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LogInfo</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [INFO] &quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è®°å½•è­¦å‘Šçº§åˆ«æ—¥å¿—</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ç”¨äºè®°å½•éœ€è¦æ³¨æ„ä½†ä¸å½±å“ç¨‹åºç»§ç»­è¿è¡Œçš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;message&quot;&gt;</span>æ—¥å¿—æ¶ˆæ¯<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LogWarning</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [WARN] &quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è®°å½•é”™è¯¯çº§åˆ«æ—¥å¿—</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ç”¨äºè®°å½•ç¨‹åºè¿è¡Œä¸­çš„é”™è¯¯å’Œå¼‚å¸¸</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;message&quot;&gt;</span>æ—¥å¿—æ¶ˆæ¯<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ex&quot;&gt;</span>å¼‚å¸¸å¯¹è±¡ï¼ˆå¯é€‰ï¼‰<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LogError</span>(<span class="params"><span class="built_in">string</span> message, Exception ex = <span class="literal">null</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [ERROR] &quot;</span> + message);</span><br><span class="line">            <span class="keyword">if</span> (ex != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [ERROR] å¼‚å¸¸ç±»å‹: &quot;</span> + ex.GetType().Name);</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [ERROR] å¼‚å¸¸æ¶ˆæ¯: &quot;</span> + ex.Message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> èµ„æºæ¸…ç†</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> é‡Šæ”¾ç¨‹åºèµ„æº</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> å®ç°IDisposableæ¥å£ï¼Œæ”¯æŒusingè¯­å¥</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            _isRunning = <span class="literal">false</span>;</span><br><span class="line">            LogInfo(<span class="string">&quot;ç¨‹åºèµ„æºå·²é‡Šæ”¾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> ç¨‹åºä¸»å…¥å£ç±»</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> åŒ…å«Mainæ–¹æ³•å’Œç¨‹åºå¯åŠ¨é€»è¾‘</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> åº”ç”¨ç¨‹åºä¸»å…¥å£ç‚¹</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> ä¸»è¦æµç¨‹ï¼š</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. åˆ›å»ºNetIdleShutdownå®ä¾‹</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. è®¾ç½®Ctrl+Cä¸­æ–­å¤„ç†</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. è¿è¡Œç½‘ç»œæ£€æµ‹ä¸»å¾ªç¯</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 4. å¤„ç†å¼‚å¸¸å¹¶ä¼˜é›…é€€å‡º</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;args&quot;&gt;</span>å‘½ä»¤è¡Œå‚æ•°ï¼ˆå½“å‰ç‰ˆæœ¬æœªä½¿ç”¨ï¼‰<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [SYSTEM] ç¨‹åºå¯åŠ¨ä¸­...&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> shutdown = <span class="keyword">new</span> NetIdleShutdown())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// è®¾ç½®æ§åˆ¶å°å…³é—­äº‹ä»¶å¤„ç†ï¼ˆCtrl+Cï¼‰</span></span><br><span class="line">                Console.CancelKeyPress += (sender, e) =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [SYSTEM] æ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œæ­£åœ¨åœæ­¢ç¨‹åº...&quot;</span>);</span><br><span class="line">                    shutdown.Stop();</span><br><span class="line">                    e.Cancel = <span class="literal">true</span>; <span class="comment">// é˜²æ­¢ç¨‹åºç«‹å³é€€å‡º</span></span><br><span class="line">                &#125;;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [SYSTEM] ç¨‹åºå·²å¯åŠ¨ï¼Œå¼€å§‹ç½‘ç»œç›‘æ§&quot;</span>);</span><br><span class="line">                    shutdown.Run();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [SYSTEM] ç¨‹åºè¿è¡Œå¤±è´¥: &quot;</span> + ex.Message);</span><br><span class="line">                    Environment.Exit(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [SYSTEM] ç¨‹åºå·²é€€å‡º&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆå“ <a target="_blank" rel="noopener" href="https://github.com/utgnim/NetIdleShutdown.cs/raw/refs/heads/master/NetIdleShutdown.cs">NetIdleShutdown.cs</a></p>
<p>3 åˆ†é’Ÿç‰ˆ <a target="_blank" rel="noopener" href="https://github.com/utgnim/NetIdleShutdown.cs/raw/refs/heads/master/3minNetIdleShutdown.exe">3minNetIdleShutdown.exe</a></p>
<p>30 åˆ†é’Ÿç‰ˆ <a target="_blank" rel="noopener" href="https://github.com/utgnim/NetIdleShutdown.cs/raw/refs/heads/master/30minNetIdleShutdown.exe">30minNetIdleShutdown.exe</a></p>
<p>GitHubåœ°å€ <a target="_blank" rel="noopener" href="https://github.com/utgnim/NetIdleShutdown.cs.git">https://github.com/utgnim/NetIdleShutdown.cs.git</a></p>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8A%80%E6%9C%AF/" rel="tag">æŠ€æœ¯</a></li></ul></div><div class="post-nav"><a class="pre" href="/%E7%8E%B0%E8%B1%A1%E4%B8%83%E5%8D%81%E4%BA%8C%E5%8F%98/">ç°è±¡ä¸ƒåäºŒå˜</a><a class="next" href="/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E4%BA%8C%E5%8D%81%E4%BA%8C/">æµ®ç”Ÿå…­è®°-å·ä¸€-é—ºæˆ¿è®°ä¹-äºŒåäºŒ</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://utgnim.github.io"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="/img/49590221.png"/></a><p>To be a better man.</p><a class="info-icon" href="mailto:utgnim@hotmail.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/utgnim" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a><a class="info-icon" target="_blank" style="margin-inline:5px"> <i class="fa fa--square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%96%87%E7%AB%A0/">æ–‡ç« </a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AD%8C%E8%AF%8D/">æ­Œè¯</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%8B%B1%E6%96%87/">è‹±æ–‡</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AC%E8%BD%BD/">è½¬è½½</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/%E7%8E%B0%E8%B1%A1%E4%B8%83%E5%8D%81%E4%BA%8C%E5%8F%98/">ç°è±¡ä¸ƒåäºŒå˜</a></li><li class="post-list-item"><a class="post-list-link" href="/NetIdleShutdown-%E6%97%A0%E7%BD%91%E7%BB%9C%E6%97%A0%E6%93%8D%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%85%B3%E6%9C%BA%E5%B0%8F%E7%A8%8B%E5%BA%8F-C/">NetIdleShutdown æ— ç½‘ç»œæ— æ“ä½œè‡ªåŠ¨å…³æœºå°ç¨‹åº[C#]</a></li><li class="post-list-item"><a class="post-list-link" href="/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E4%BA%8C%E5%8D%81%E4%BA%8C/">æµ®ç”Ÿå…­è®°-å·ä¸€-é—ºæˆ¿è®°ä¹-äºŒåäºŒ</a></li><li class="post-list-item"><a class="post-list-link" href="/%E5%85%B3%E4%BA%8E-Windows-Server-2022-%E5%AE%89%E8%A3%85%E5%9C%A8%E7%AC%94%E8%AE%B0%E6%9C%AC%E4%B8%8A%E4%B8%80%E4%BA%9B%E5%86%85%E5%AE%B9%E6%95%B4%E7%90%86%E5%8F%82%E8%80%83/">å…³äº Windows Server 2022 å®‰è£…åœ¨ç¬”è®°æœ¬ä¸Šä¸€äº›å†…å®¹æ•´ç†å‚è€ƒ</a></li><li class="post-list-item"><a class="post-list-link" href="/%E8%AF%84%E6%99%AE%E9%B2%81%E5%A3%AB%E6%9C%80%E8%BF%91%E7%9A%84%E4%B9%A6%E6%8A%A5%E6%A3%80%E6%9F%A5%E4%BB%A4/">è¯„æ™®é²å£«æœ€è¿‘çš„ä¹¦æŠ¥æ£€æŸ¥ä»¤</a></li><li class="post-list-item"><a class="post-list-link" href="/%E9%9D%92%E5%B9%B4%E5%9C%A8%E9%80%89%E6%8B%A9%E8%81%8C%E4%B8%9A%E6%97%B6%E7%9A%84%E8%80%83%E8%99%91/">é’å¹´åœ¨é€‰æ‹©èŒä¸šæ—¶çš„è€ƒè™‘</a></li><li class="post-list-item"><a class="post-list-link" href="/%E2%80%9C%E5%8F%A4%E6%96%87%E8%A7%82%E6%AD%A2%E2%80%9D/">â€œå¤æ–‡è§‚æ­¢â€</a></li><li class="post-list-item"><a class="post-list-link" href="/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E4%BA%8C%E5%8D%81%E4%B8%80/">æµ®ç”Ÿå…­è®° - å·ä¸€ é—ºæˆ¿è®°ä¹ äºŒåä¸€</a></li><li class="post-list-item"><a class="post-list-link" href="/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E4%BA%8C%E5%8D%81/">æµ®ç”Ÿå…­è®° - å·ä¸€ é—ºæˆ¿è®°ä¹ äºŒå</a></li><li class="post-list-item"><a class="post-list-link" href="/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E6%8B%BE%E7%8E%96/">æµ®ç”Ÿå…­è®° - å·ä¸€ é—ºæˆ¿è®°ä¹ æ‹¾ç–</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://utgnim.github.io/" title="Mingtu's äºŒä¸‰äº‹" target="_blank">Mingtu's äºŒä¸‰äº‹</a><ul></ul><a href="/hello-world/" title="Galgame" target="_blank">Galgame</a><ul></ul><a target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2026 <a href="/." rel="nofollow">It's a blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>