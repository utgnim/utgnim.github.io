<!--
 * @Author: wesker
 * @Date: 2022-09-13 16:07:19
 * @FilePath: \hexo-theme-galf:\others\gal-theme\layout\_partial\head.ejs
 * Copyright (c) 2022 by wesker hentai121@163.com, All Rights Reserved. 
-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/x-icon" href="/imgs/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="Mingtu2019">
    
    
    
    
    
    
    <title>NetIdleShutdown 无网络无操作自动关机小程序[C#] | It&#39;s a blog</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://utgnim.github.io/sukebei" rel="prefetch" />

    
<link rel="stylesheet" href="/sukebei/css/bootstrap.min.css">
<link rel="stylesheet" href="/sukebei/css/aos.css">
<link rel="stylesheet" href="/sukebei/css/style.css">

    
<script src="/sukebei/js/jquery.min.js"></script>

    
<script src="/sukebei/js/bootstrap.min.js"></script>

    
<script src="/sukebei/js/aos.js"></script>

    
<script src="/sukebei/js/highslide/highslide-full.min.js"></script>

    
<link rel="stylesheet" href="/sukebei/js/highslide/highslide.css">

    <style type="text/css">
        @media (max-width: 768px) {
            body {
                background-color: #f0f0f0;
                background: url('/imgs/xsbg.gif');
                background-attachment: fixed;
            }
        }
    </style>
    
    <!--<script type="text/javascript">
      if (document.images) {
        var avatar = new Image();
        avatar.src = '/sukebei/imgs/49590221.png'
        var previews = 'preview1.jpg,preview2.jpg,preview3.jpg,preview4.jpg,preview5.jpg,preview6.jpg,preview7.jpg,preview8.jpg,preview9.jpg,preview10.jpg,preview11.jpg,preview12.jpg,preview13.jpg,preview14.jpg,preview15.jpg,preview16.jpg,preview17.jpg,preview18.jpg,preview19.jpg,preview20.jpg,preview21.jpg,preview22.jpg,preview23.jpg,preview24.jpg,preview25.jpg,preview26.jpg,preview27.jpg,preview28.jpg,preview29.jpg,preview30.jpg,preview31.jpg,preview32.jpg,preview33.jpg,preview34.jpg,preview35.jpg,preview36.jpg,preview37.jpg,preview38.jpg,preview39.jpg,preview40.jpg,preview41.jpg,preview42.jpg,preview43.jpg,preview44.jpg,preview45.jpg,preview46.jpg,preview47.jpg,preview48.jpg,preview49.jpg,preview50.jpg,preview51.jpg,preview52.jpg,preview53.jpg,preview54.jpg,preview55.jpg,preview56.jpg,preview57.jpg,preview58.jpg,preview59.jpg,preview60.jpg,preview61.jpg,preview62.jpg,preview63.jpg,preview64.jpg,preview65.jpg,preview66.jpg,preview67.jpg,preview68.jpg,preview69.jpg,preview70.jpg,preview71.jpg,preview72.jpg,preview73.jpg,preview74.jpg,preview75.jpg,preview76.jpg,preview77.jpg,preview78.jpg,preview79.jpg,preview80.jpg,preview81.jpg,preview82.jpg,preview83.jpg,preview84.jpg,preview85.jpg,preview86.jpg,preview87.jpg,preview88.jpg,preview89.jpg,preview90.jpg,preview91.jpg,preview92.jpg,preview93.jpg,preview94.jpg,preview95.jpg,preview96.jpg,preview97.jpg,preview98.jpg,preview99.jpg,preview100.jpg,preview101.jpg,preview102.jpg,preview103.jpg,preview104.jpg,preview105.jpg,preview106.jpg,preview107.jpg,preview108.jpg,preview109.jpg,preview110.jpg,preview111.jpg,preview112.jpg,preview113.jpg,preview114.jpg,preview115.jpg,preview116.jpg,preview117.jpg,preview118.jpg,preview119.jpg,preview120.jpg,preview121.jpg,preview122.jpg,preview123.jpg,preview124.jpg,preview125.jpg,preview126.jpg,preview127.jpg,preview128.jpg,preview129.jpg,preview130.jpg,preview131.jpg,preview132.jpg,preview133.jpg,preview134.jpg,preview135.jpg,preview136.jpg,preview137.jpg,preview138.jpg,preview139.jpg,preview140.jpg,preview141.jpg,preview142.jpg,preview143.jpg,preview144.jpg,preview145.jpg,preview146.jpg,preview147.jpg,preview148.jpg,preview149.jpg,preview150.jpg,preview151.jpg,preview152.jpg,preview153.jpg,preview154.jpg,preview155.jpg,preview156.jpg,preview157.jpg,preview158.jpg,preview159.jpg,preview160.jpg,preview161.jpg,preview162.jpg,preview163.jpg,preview164.jpg,preview165.jpg,preview166.jpg,preview167.jpg,preview168.jpg,preview169.jpg,preview170.jpg,preview171.jpg,preview172.jpg,preview173.jpg,preview174.jpg,preview175.jpg,preview176.jpg,preview177.jpg,preview178.jpg,preview179.jpg,preview180.jpg,preview181.jpg,preview182.jpg,preview183.jpg,preview184.jpg,preview185.jpg,preview186.jpg,preview187.jpg,preview188.jpg,preview189.jpg,preview190.jpg,preview191.jpg,preview192.jpg,preview193.jpg,preview194.jpg,preview195.jpg,preview196.jpg,preview197.jpg,preview198.jpg,preview199.jpg,preview200.jpg,preview201.jpg,preview202.jpg,preview203.jpg,preview204.jpg,preview205.jpg,preview206.jpg,preview207.jpg,preview208.jpg,preview209.jpg,preview210.jpg,preview211.jpg,preview212.jpg,preview213.jpg,preview214.jpg,preview215.jpg,preview216.jpg,preview217.jpg,preview218.jpg,preview219.jpg,preview220.jpg,preview221.jpg,preview222.jpg,preview223.jpg,preview224.jpg,preview225.jpg,preview226.jpg,preview227.jpg,preview228.jpg,preview229.jpg,preview230.jpg,preview231.jpg,preview232.jpg,preview233.jpg,preview234.jpg,preview235.jpg,preview236.jpg,preview237.jpg,preview238.jpg,preview239.jpg,preview240.jpg,preview241.jpg,preview242.jpg,preview243.jpg,preview244.jpg,preview245.jpg,preview246.jpg,preview247.jpg,preview248.jpg,preview249.jpg,preview250.jpg,preview251.jpg,preview252.jpg,preview253.jpg,preview254.jpg,preview255.jpg,preview256.jpg,preview257.jpg,preview258.jpg,preview259.jpg,preview260.jpg,preview261.jpg,preview262.jpg,preview263.jpg,preview264.jpg,preview265.jpg,preview266.jpg,preview267.jpg,preview268.jpg,preview269.jpg,preview270.jpg,preview271.jpg,preview272.jpg,preview273.jpg,preview274.jpg,preview275.jpg,preview276.jpg,preview277.jpg,preview278.jpg,preview279.jpg,preview280.jpg,preview281.jpg,preview282.jpg,preview283.jpg,preview284.jpg,preview285.jpg,preview286.jpg,preview287.jpg,preview288.jpg,preview289.jpg,preview290.jpg,preview291.jpg,preview292.jpg,preview293.jpg,preview294.jpg,preview295.jpg,preview296.jpg,preview297.jpg,preview298.jpg,preview299.jpg,preview300.jpg,preview301.jpg,preview302.jpg,preview303.jpg,preview304.jpg,preview305.jpg,preview306.jpg,preview307.jpg,preview308.jpg,preview309.jpg,preview310.jpg,preview311.jpg,preview312.jpg,preview313.jpg,preview314.jpg,preview315.jpg,preview316.jpg,preview317.jpg,preview318.jpg,preview319.jpg,preview320.jpg,preview321.jpg,preview322.jpg,preview323.jpg,preview324.jpg,preview325.jpg,preview326.jpg,preview327.jpg,preview328.jpg,preview329.jpg,preview330.jpg,preview331.jpg,preview332.jpg,preview333.jpg,preview334.jpg,preview335.jpg,preview336.jpg,preview337.jpg,preview338.jpg,preview339.jpg,preview340.jpg,preview341.jpg,preview342.jpg,preview343.jpg,preview344.jpg,preview345.jpg,preview346.jpg,preview347.jpg,preview348.jpg,preview349.jpg,preview350.jpg,preview351.jpg,preview352.jpg,preview353.jpg,preview354.jpg,preview355.jpg,preview356.jpg,preview357.jpg,preview358.jpg,preview359.jpg,preview360.jpg,preview361.jpg,preview362.jpg,preview363.jpg,preview364.jpg,preview365.jpg,preview366.jpg,preview367.jpg,preview368.jpg,preview369.jpg,preview370.jpg,preview371.jpg,preview372.jpg,preview373.jpg,preview374.jpg,preview375.jpg,preview376.jpg,preview377.jpg,preview378.jpg,preview379.jpg,preview380.jpg,preview381.jpg,preview382.jpg,preview383.jpg,preview384.jpg,preview385.jpg,preview386.jpg,preview387.jpg,preview388.jpg,preview389.jpg,preview390.jpg,preview391.jpg,preview392.jpg,preview393.jpg,preview394.jpg,preview395.jpg,preview396.jpg,preview397.jpg,preview398.jpg,preview399.jpg,preview400.jpg,preview401.jpg,preview402.jpg,preview403.jpg,preview404.jpg,preview405.jpg,preview406.jpg,preview407.jpg,preview408.jpg,preview409.jpg,preview410.jpg,preview411.jpg,preview412.jpg,preview413.jpg,preview414.jpg,preview415.jpg,preview416.jpg,preview417.jpg,preview418.jpg,preview419.jpg,preview420.jpg,preview421.jpg,preview422.jpg,preview423.jpg,preview424.jpg,preview425.jpg,preview426.jpg,preview427.jpg,preview428.jpg,preview429.jpg,preview430.jpg,preview431.jpg,preview432.jpg,preview433.jpg,preview434.jpg,preview435.jpg,preview436.jpg,preview437.jpg,preview438.jpg,preview439.jpg,preview440.jpg,preview441.jpg,preview442.jpg,preview443.jpg,preview444.jpg,preview445.jpg,preview446.jpg,preview447.jpg,preview448.jpg,preview449.jpg,preview450.jpg,preview451.jpg,preview452.jpg,preview453.jpg,preview454.jpg,preview455.jpg,preview456.jpg,preview457.jpg,preview458.jpg,preview459.jpg,preview460.jpg,preview461.jpg,preview462.jpg,preview463.jpg,preview464.jpg,preview465.jpg,preview466.jpg,preview467.jpg,preview468.jpg,preview469.jpg,preview470.jpg,preview471.jpg,preview472.jpg,preview473.jpg,preview474.jpg,preview475.jpg,preview476.jpg,preview477.jpg,preview478.jpg,preview479.jpg,preview480.jpg,preview481.jpg,preview482.jpg,preview483.jpg,preview484.jpg,preview485.jpg,preview486.jpg,preview487.jpg,preview488.jpg,preview489.jpg,preview490.jpg,preview491.jpg,preview492.jpg,preview493.jpg,preview494.jpg,preview495.jpg,preview496.jpg,preview497.jpg,preview498.jpg,preview499.jpg,preview500.jpg,preview501.jpg,preview502.jpg,preview503.jpg,preview504.jpg,preview505.jpg,preview506.jpg,preview507.jpg,preview508.jpg,preview509.jpg,preview510.jpg,preview511.jpg,preview512.jpg,preview513.jpg,preview514.jpg,preview515.jpg,preview516.jpg,preview517.jpg,preview518.jpg,preview519.jpg,preview520.jpg,preview521.jpg,preview522.jpg,preview523.jpg,preview524.jpg,preview525.jpg,preview526.jpg,preview527.jpg,preview528.jpg,preview529.jpg,preview530.jpg,preview531.jpg,preview532.jpg,preview533.jpg,preview534.jpg,preview535.jpg,preview536.jpg,preview537.jpg,preview538.jpg,preview539.jpg,preview540.jpg,preview541.jpg,preview542.jpg,preview543.jpg,preview544.jpg,preview545.jpg,preview546.jpg,preview547.jpg,preview548.jpg,preview549.jpg,preview550.jpg,preview551.jpg,preview552.jpg,preview553.jpg,preview554.jpg,preview555.jpg,preview556.jpg,preview557.jpg,preview558.jpg,preview559.jpg,preview560.jpg,preview561.jpg,preview562.jpg,preview563.jpg,preview564.jpg,preview565.jpg,preview566.jpg,preview567.jpg,preview568.jpg,preview569.jpg,preview570.jpg,preview571.jpg,preview572.jpg,preview573.jpg,preview574.jpg,preview575.jpg,preview576.jpg,preview577.jpg,preview578.jpg,preview579.jpg,preview580.jpg,preview581.jpg,preview582.jpg,preview583.jpg,preview584.jpg,preview585.jpg,preview586.jpg,preview587.jpg,preview588.jpg,preview589.jpg,preview590.jpg,preview591.jpg,preview592.jpg,preview593.jpg,preview594.jpg,preview595.jpg,preview596.jpg,preview597.jpg,preview598.jpg,preview599.jpg,preview600.jpg,preview601.jpg,preview602.jpg,preview603.jpg,preview604.jpg,preview605.jpg,preview606.jpg,preview607.jpg,preview608.jpg,preview609.jpg,preview610.jpg,preview611.jpg,preview612.jpg,preview613.jpg,preview614.jpg,preview615.jpg,preview616.jpg,preview617.jpg,preview618.jpg,preview619.jpg,preview620.jpg,preview621.jpg,preview622.jpg,preview623.jpg,preview624.jpg,preview625.jpg,preview626.jpg,preview627.jpg,preview628.jpg,preview629.jpg,preview630.jpg,preview631.jpg,preview632.jpg,preview633.jpg,preview634.jpg,preview635.jpg,preview636.jpg,preview637.jpg,preview638.jpg,preview639.jpg,preview640.jpg,preview641.jpg,preview642.jpg,preview643.jpg,preview644.jpg,preview645.jpg,preview646.jpg,preview647.jpg,preview648.jpg,preview649.jpg,preview650.jpg,preview651.jpg,preview652.jpg,preview653.jpg,preview654.jpg,preview655.jpg,preview656.jpg,preview657.jpg,preview658.jpg,preview659.jpg,preview660.jpg,preview661.jpg,preview662.jpg,preview663.jpg,preview664.jpg,preview665.jpg,preview666.jpg,preview667.jpg,preview668.jpg,preview669.jpg,preview670.jpg,preview671.jpg,preview672.jpg,preview673.jpg,preview674.jpg,preview675.jpg,preview676.jpg,preview677.jpg,preview678.jpg,preview679.jpg,preview680.jpg,preview681.jpg,preview682.jpg,preview683.jpg,preview684.jpg,preview685.jpg,preview686.jpg,preview687.jpg,preview688.jpg,preview689.jpg,preview690.jpg,preview691.jpg,preview692.jpg,preview693.jpg,preview694.jpg,preview695.jpg,preview696.jpg,preview697.jpg,preview698.jpg,preview699.jpg,preview700.jpg,preview701.jpg,preview702.jpg,preview703.jpg,preview704.jpg,preview705.jpg,preview706.jpg,preview707.jpg,preview708.jpg,preview709.jpg,preview710.jpg,preview711.jpg,preview712.jpg,preview713.jpg,preview714.jpg,preview715.jpg,preview716.jpg,preview717.jpg,preview718.jpg,preview719.jpg'.split(',')
        var previewsPreLoad = []
        for(var i = 0; i < length; i++) {
          previewsPreLoad.push(new Image())
          previewsPreLoad[previewsPreLoad.length - 1].src = '/sukebei/imgs/preview' + previews[i]
        }
      }
    </script>-->
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/sukebei/atom.xml" title="It's a blog" type="application/atom+xml">
</head>
<body>
    <!-- 背景轮播图功能 -->
    <section class="hidden-xs">
    <ul class="cb-slideshow">
        <li><span>天若</span></li>
        <li><span>有情</span></li>
        <li><span>天亦老</span></li>
        <li><span>我为</span></li>
        <li><span>长者</span></li>
        <li><span>续一秒</span></li>
    </ul>
</section>
    <!-- 欧尼酱功能, 谁用谁知道 -->
    
    <div class="gal-menu gal-dropdown">
    <div class="circle" id="gal">
        <div class="ring">
            <a href="https://utgnim.github.io/sukebei" class="menuItem" style="left: 50%; top: 15%;">首页</a>
            
            <a class="menuItem" style="left: 80.3109%; top: 32.5%;">下一页</a>
            
            <a href="/sukebei/archives" class="menuItem" style="left: 80.3109%; top: 67.5%;">归档</a>
            <a href="/sukebei/about" class="menuItem" style="left: 50%; top: 85%;">关于</a>
            <a href="/sukebei/message" class="menuItem" style="left: 19.6891%; top: 67.5%;">留言板</a>

            
            <a class="menuItem" style="left: 19.6891%; top: 32.5%;">上一页</a>
            
        </div>
        <audio id="audio" src="/sukebei/imgs/oni.mp3"></audio>
    </div>
</div>
    
    <header class="navbar navbar-inverse" id="gal-header">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".bs-navbar-collapse"
                    aria-expanded="false">
                <span class="fa fa-lg fa-reorder"></span>
            </button>
            <a href="https://utgnim.github.io/sukebei">
                
                <style>
                    #gal-header .navbar-brand {
                        height: 54px;
                        line-height: 24px;
                        font-size: 28px;
                        opacity: 1;
                        background-color: rgba(0,0,0,0);
                        text-shadow: 0 0 5px #fff,0 0 10px #fff,0 0 15px #fff,0 0 20px #228DFF,0 0 35px #228DFF,0 0 40px #228DFF,0 0 50px #228DFF,0 0 75px #228DFF;
                    }
                </style>
                <!-- 这里使用文字(navbar_text or config.title) -->
                <div class="navbar-brand">Mingtu&#39;s Blog ！！！</div>
                
            </a>
        </div>
        <div class="collapse navbar-collapse bs-navbar-collapse">
            <ul class="nav navbar-nav" id="menu-gal">
                
                
                <li class="">
                    <a href="/sukebei/">
                        <i class="fa fa-home"></i> 首页
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/sukebei/">
                        <i class="fa fa-book"></i> 文章
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/sukebei/archives">
                        <i class="fa fa-archive"></i> 归档
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/sukebei/links">
                        <i class="fa fa-link"></i> 链接
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/sukebei/about">
                        <i class="fa fa-user"></i>关于
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/sukebei/../">
                        <i class="fa fa-refresh"></i>大道至简
                    </a>
                </li>
                
                
            </ul>
        </div>
    </div>
</header>
    <div id="gal-body">
        <div class="container">
            <div class="row">
                <div class="col-md-8 gal-right" id="mainstay">
                    
<article class="article well article-body" id="article">
    <div class="breadcrumb">
        <i class="fa fa-home"></i>
        <a href="https://utgnim.github.io/sukebei">It&#39;s a blog</a>
        >
        <span>NetIdleShutdown 无网络无操作自动关机小程序[C#]</span>
    </div>
    <!-- 大型设备详细文章 -->
    <div class="hidden-xs">
        <div class="title-article">
            <h1>
                <a href="/sukebei/NetIdleShutdown-%E6%97%A0%E7%BD%91%E7%BB%9C%E6%97%A0%E6%93%8D%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%85%B3%E6%9C%BA%E5%B0%8F%E7%A8%8B%E5%BA%8F-C/">NetIdleShutdown 无网络无操作自动关机小程序[C#]</a>
            </h1>
        </div>
        <div class="tag-article">
            
                
                <span class="label label-gal"><i class="fa fa-tag"></i> <a href="/sukebei/tags/%E6%8A%80%E6%9C%AF/">技术</a></span>
                
            
            <span class="label label-gal">
                <i class="fa fa-calendar"></i> 2026-02-13
            </span>
            
        </div>
    </div>
    <!-- 小型设备详细文章 -->
    <div class="visible-xs">
        <center>
            <div class="title-article">
                <h4>
                    <a href="/sukebei/NetIdleShutdown-%E6%97%A0%E7%BD%91%E7%BB%9C%E6%97%A0%E6%93%8D%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%85%B3%E6%9C%BA%E5%B0%8F%E7%A8%8B%E5%BA%8F-C/">NetIdleShutdown 无网络无操作自动关机小程序[C#]</a>
                </h4>
            </div>
            <p>
                <i class="fa fa-calendar"></i> 2026-02-13
            </p>
            <p>
                
                
                <i class="fa fa-tag"></i> <a href="/sukebei/tags/%E6%8A%80%E6%9C%AF/">技术</a>
                
                
                
            </p>
        </center>
    </div>
    <div class="content-article">
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>远程操控位于家中的电脑时，偶尔会遇到路由器或光猫当机的情况，网络突然断开，电脑却还没关机，只能等待下次断电路由器或光猫重启才能重新连接上电脑，这就非常耗电，于是有了这个小工具！</p>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>由于本人十分的菜，尽管也曾憧憬过成为一个程序员，但一直三分热度、半途而废，到最后不了了之。所以你可以猜到代码并不是我写的。</p>
<p>代码由 Gemini 提供思路，DeepSeek 写成，经历了大约三天的时间，期间不断的请 AI 修改、编译，手动测试，最后终于能够成功运行。经初步短期测试，应该没有什么大问题，故分享出来，代码<code>NetIdleShutdown.cs</code>如下：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Net.NetworkInformation;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Concurrent;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">NetIdleShutdown</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 网络空闲关机程序</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 主要功能：</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 1. 检测网络连接状态（双重检测：Ping + HTTP）</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 2. 检测用户活动状态</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 3. 当网络断开且用户无操作时，自动执行关机操作</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 检测逻辑：</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - 使用并行线程同时检测多个目标，提高检测速度</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - 如果所有Ping目标都失败，则直接判断为网络离线</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - 如果有至少一个Ping成功，则继续进行HTTP检测</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - 必须同时满足Ping和HTTP检测都至少有一个成功，才判断为在线</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 配置说明：</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - 程序默认配置在AppConfig类中</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> - 可修改默认值或通过构造函数传入自定义配置</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NetIdleShutdown</span> : <span class="title">IDisposable</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 配置类</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 应用程序配置类</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 包含所有可配置的参数和检测目标列表</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AppConfig</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 核心配置参数</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> MaxNoNetMinutes = <span class="number">3</span>;           <span class="comment">// 无网络多少分钟后关机</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> PingTimeoutMs = <span class="number">1500</span>;          <span class="comment">// Ping超时时间（毫秒）- 控制线程等待时间</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> HttpTimeoutMs = <span class="number">5000</span>;          <span class="comment">// HTTP请求超时时间（毫秒）- 控制线程等待时间</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> CheckIntervalSeconds = <span class="number">60</span>;     <span class="comment">// 检测间隔时间（秒）- 主循环等待时间</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> UserIdleThresholdSeconds = <span class="number">60</span>; <span class="comment">// 用户空闲时间阈值（秒）- 判定用户无活动的阈值</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 检测目标列表</span></span><br><span class="line">            <span class="keyword">public</span> List&lt;<span class="built_in">string</span>&gt; PingTargets;  <span class="comment">// Ping检测目标IP地址列表</span></span><br><span class="line">            <span class="keyword">public</span> List&lt;<span class="built_in">string</span>&gt; HttpTargets;  <span class="comment">// HTTP检测目标URL列表</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">            <span class="comment"><span class="doctag">///</span> 构造函数，初始化默认配置和检测目标</span></span><br><span class="line">            <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">AppConfig</span>()</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 初始化Ping检测目标列表</span></span><br><span class="line">                <span class="comment">// 包含国内外常用的公共DNS服务器，提高检测可靠性</span></span><br><span class="line">                PingTargets = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;223.5.5.5&quot;</span>,        <span class="comment">// 阿里DNS - 国内常用</span></span><br><span class="line">                    <span class="string">&quot;119.29.29.29&quot;</span>,     <span class="comment">// 腾讯DNS - 国内常用</span></span><br><span class="line">                    <span class="string">&quot;180.76.76.76&quot;</span>,     <span class="comment">// 百度DNS - 国内常用</span></span><br><span class="line">                    <span class="string">&quot;1.1.1.1&quot;</span>,          <span class="comment">// Cloudflare DNS - 国际常用</span></span><br><span class="line">                    <span class="string">&quot;8.8.8.8&quot;</span>,          <span class="comment">// Google DNS - 国际常用</span></span><br><span class="line">                    <span class="string">&quot;114.114.114.114&quot;</span>,  <span class="comment">// 114DNS - 国内常用</span></span><br><span class="line">                    <span class="string">&quot;208.67.222.222&quot;</span>,   <span class="comment">// OpenDNS - 国际备用</span></span><br><span class="line">                    <span class="string">&quot;9.9.9.9&quot;</span>           <span class="comment">// Quad9 DNS - 国际备用</span></span><br><span class="line">                &#125;;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 初始化HTTP检测目标列表</span></span><br><span class="line">                <span class="comment">// 使用各大公司的网络连通性检测服务，通常返回204状态码</span></span><br><span class="line">                HttpTargets = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;http://connect.rom.miui.com/generate_204&quot;</span>,          <span class="comment">// 小米网络检测服务</span></span><br><span class="line">                    <span class="string">&quot;http://connectivitycheck.gstatic.com/generate_204&quot;</span>, <span class="comment">// Google网络检测服务</span></span><br><span class="line">                    <span class="string">&quot;http://www.gstatic.com/generate_204&quot;</span>,               <span class="comment">// Google备用检测服务</span></span><br><span class="line">                    <span class="string">&quot;http://www.msftncsi.com/ncsi.txt&quot;</span>,                  <span class="comment">// Microsoft网络检测服务</span></span><br><span class="line">                    <span class="string">&quot;http://captive.apple.com/hotspot-detect.html&quot;</span>,      <span class="comment">// Apple网络检测服务</span></span><br><span class="line">                    <span class="string">&quot;http://connectivitycheck.platform.hicloud.com/generate_204&quot;</span> <span class="comment">// 华为网络检测服务</span></span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> Windows API声明</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取系统最后输入时间的Windows API函数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用于检测用户活动状态</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;plii&quot;&gt;</span>LASTINPUTINFO结构体引用<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>获取成功返回true，失败返回false<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;user32.dll&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">GetLastInputInfo</span>(<span class="params"><span class="keyword">ref</span> LASTINPUTINFO plii</span>)</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 最后输入信息结构体</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用于存储用户最后输入的时间信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">StructLayout(LayoutKind.Sequential)</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">struct</span> LASTINPUTINFO</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">uint</span> cbSize;    <span class="comment">// 结构体大小</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">uint</span> dwTime;    <span class="comment">// 最后输入时间（系统启动后的毫秒数）</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 私有字段</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> AppConfig _config;                <span class="comment">// 程序配置实例</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> _noNetCounter = <span class="number">0</span>;                     <span class="comment">// 无网络计数器</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">bool</span> _isRunning = <span class="literal">true</span>;                    <span class="comment">// 程序运行标志</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">object</span> _counterLock = <span class="keyword">new</span> <span class="built_in">object</span>(); <span class="comment">// 计数器同步锁</span></span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 构造函数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 构造函数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;config&quot;&gt;</span>自定义配置，如果为null则使用默认配置<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">NetIdleShutdown</span>(<span class="params">AppConfig config = <span class="literal">null</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用传入的配置或创建默认配置</span></span><br><span class="line">            _config = config ?? <span class="keyword">new</span> AppConfig();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 记录配置信息</span></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[SYSTEM] 程序配置已加载&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[SYSTEM] 无网络关机阈值: &quot;</span> + _config.MaxNoNetMinutes + <span class="string">&quot; 分钟&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[SYSTEM] 检测间隔: &quot;</span> + _config.CheckIntervalSeconds + <span class="string">&quot; 秒&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[SYSTEM] 用户空闲阈值: &quot;</span> + _config.UserIdleThresholdSeconds + <span class="string">&quot; 秒&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 主程序入口</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 启动网络守护程序主循环</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Run</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 显示程序标题和配置信息</span></span><br><span class="line">                PrintBanner();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 主循环：持续检测网络和用户状态</span></span><br><span class="line">                <span class="keyword">while</span> (_isRunning)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 执行一次完整的检测周期</span></span><br><span class="line">                    PerformCheckCycle();</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// 等待指定的间隔时间，每秒检查一次是否停止</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; _config.CheckIntervalSeconds &amp;&amp; _isRunning; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 记录严重错误并重新抛出</span></span><br><span class="line">                LogError(<span class="string">&quot;程序运行异常&quot;</span>, ex);</span><br><span class="line">                <span class="keyword">throw</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 停止守护程序</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 设置运行标志为false，使主循环退出</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Stop</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            _isRunning = <span class="literal">false</span>;</span><br><span class="line">            LogInfo(<span class="string">&quot;程序已收到停止指令&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 检测周期</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 执行一个完整的检测周期</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 包括网络检测、用户活动检测和状态处理</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PerformCheckCycle</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> timestamp = DateTime.Now;</span><br><span class="line">            LogInfo(<span class="string">&quot;开始第 &quot;</span> + (_noNetCounter + <span class="number">1</span>) + <span class="string">&quot; 次检测&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 检测网络连接状态</span></span><br><span class="line">            <span class="built_in">bool</span> isOnline = CheckConnectivity();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 根据网络状态进行相应处理</span></span><br><span class="line">            <span class="keyword">if</span> (isOnline)</span><br><span class="line">            &#123;</span><br><span class="line">                HandleOnlineStatus(timestamp);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                HandleOfflineStatus(timestamp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 处理在线状态</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 网络正常时重置计数器并记录状态</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;timestamp&quot;&gt;</span>检测时间戳<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HandleOnlineStatus</span>(<span class="params">DateTime timestamp</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">lock</span> (_counterLock)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 如果之前有离线记录，则重置计数器</span></span><br><span class="line">                <span class="keyword">if</span> (_noNetCounter &gt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    LogInfo(<span class="string">&quot;网络恢复正常，无网络计数器已重置&quot;</span>);</span><br><span class="line">                    _noNetCounter = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            LogInfo(<span class="string">&quot;网络状态: 在线&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 处理离线状态</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 网络断开时检查用户活动并更新计数器</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;timestamp&quot;&gt;</span>检测时间戳<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HandleOfflineStatus</span>(<span class="params">DateTime timestamp</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 检测用户是否有输入活动</span></span><br><span class="line">            <span class="built_in">bool</span> hasUserActivity = HasUserInputActivity();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (hasUserActivity)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 有用户活动，重置计数器</span></span><br><span class="line">                <span class="keyword">lock</span> (_counterLock)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (_noNetCounter &gt; <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        LogInfo(<span class="string">&quot;检测到用户活动，无网络计数器已重置&quot;</span>);</span><br><span class="line">                        _noNetCounter = <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                LogInfo(<span class="string">&quot;网络状态: 离线 (用户活动中，不计数)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 无用户活动，增加计数器</span></span><br><span class="line">                <span class="keyword">lock</span> (_counterLock)</span><br><span class="line">                &#123;</span><br><span class="line">                    _noNetCounter++;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                LogInfo(<span class="string">&quot;网络状态: 离线&quot;</span>);</span><br><span class="line">                LogInfo(<span class="string">&quot;无网络计数器: &quot;</span> + _noNetCounter + <span class="string">&quot;/&quot;</span> + _config.MaxNoNetMinutes);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 检查是否达到关机条件</span></span><br><span class="line">                <span class="keyword">if</span> (_noNetCounter &gt;= _config.MaxNoNetMinutes)</span><br><span class="line">                &#123;</span><br><span class="line">                    ExecuteShutdown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 网络检测</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 检测网络连接状态</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 检测逻辑：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. 并行执行Ping检测</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. 如果所有Ping目标都失败，直接判断为离线</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. 如果至少有一个Ping成功，则继续进行HTTP检测</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 4. 必须同时满足Ping和HTTP检测都至少有一个成功，才判断为在线</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 优化：网络完全断开时，最快800ms即可判断为离线</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>true表示网络在线，false表示网络离线<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">CheckConnectivity</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            LogInfo(<span class="string">&quot;开始网络连通性检测&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 第一步：并行执行Ping检测</span></span><br><span class="line">            <span class="built_in">bool</span> pingSuccess = PerformPingTestsParallel();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 第二步：如果Ping检测全部失败，直接判断为离线</span></span><br><span class="line">            <span class="keyword">if</span> (!pingSuccess)</span><br><span class="line">            &#123;</span><br><span class="line">                LogInfo(<span class="string">&quot;Ping检测结果: 全部失败，直接判定为网络离线&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 第三步：Ping检测通过，继续进行HTTP检测</span></span><br><span class="line">            LogInfo(<span class="string">&quot;Ping检测结果: 至少有一个成功，开始HTTP检测&quot;</span>);</span><br><span class="line">            <span class="built_in">bool</span> httpSuccess = PerformHttpTestsParallel();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 第四步：必须同时满足Ping和HTTP检测都成功</span></span><br><span class="line">            <span class="built_in">bool</span> finalResult = pingSuccess &amp;&amp; httpSuccess;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 记录详细检测结果</span></span><br><span class="line">            <span class="keyword">if</span> (finalResult)</span><br><span class="line">            &#123;</span><br><span class="line">                LogInfo(<span class="string">&quot;网络检测最终结果: 在线 (Ping和HTTP检测均通过)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                LogInfo(<span class="string">&quot;网络检测最终结果: 离线 (Ping: &quot;</span> + (pingSuccess ? <span class="string">&quot;成功&quot;</span> : <span class="string">&quot;失败&quot;</span>) + </span><br><span class="line">                       <span class="string">&quot;, HTTP: &quot;</span> + (httpSuccess ? <span class="string">&quot;成功&quot;</span> : <span class="string">&quot;失败&quot;</span>) + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> finalResult;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 并行执行Ping测试</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 实现方式：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. 为每个Ping目标创建一个独立线程</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. 所有线程同时执行，提高检测速度</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. 使用ConcurrentDictionary存储线程安全的结果</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 4. 使用Interlocked.Increment保证计数器的线程安全</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 超时控制：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 每个线程最多等待PingTimeoutMs毫秒</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 超时线程将被强制终止</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>true表示至少有一个Ping成功，false表示全部失败<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">PerformPingTestsParallel</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            LogInfo(<span class="string">&quot;开始并行Ping测试 (目标数: &quot;</span> + _config.PingTargets.Count + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">int</span> successCount = <span class="number">0</span>;  <span class="comment">// 成功计数器</span></span><br><span class="line">            <span class="keyword">var</span> results = <span class="keyword">new</span> ConcurrentDictionary&lt;<span class="built_in">string</span>, <span class="built_in">bool</span>&gt;();  <span class="comment">// 结果存储</span></span><br><span class="line">            <span class="keyword">var</span> tasks = <span class="keyword">new</span> List&lt;Thread&gt;();  <span class="comment">// 线程列表</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 为每个Ping目标创建线程</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> target <span class="keyword">in</span> _config.PingTargets)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> thread = <span class="keyword">new</span> Thread(() =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">bool</span> result = PingHostFast(target);</span><br><span class="line">                    results[target] = result;</span><br><span class="line">                    <span class="keyword">if</span> (result)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Interlocked.Increment(<span class="keyword">ref</span> successCount);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">                thread.Start();</span><br><span class="line">                tasks.Add(thread);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 等待所有线程完成，最多等待PingTimeoutMs毫秒</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> thread <span class="keyword">in</span> tasks)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!thread.Join(_config.PingTimeoutMs))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 线程超时，强制终止</span></span><br><span class="line">                    thread.Abort();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 输出Ping测试详细结果</span></span><br><span class="line">            <span class="keyword">var</span> resultBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            resultBuilder.AppendLine(<span class="string">&quot;PING检测详细结果:&quot;</span>);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> target <span class="keyword">in</span> _config.PingTargets)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">bool</span> result;</span><br><span class="line">                <span class="keyword">if</span> (results.TryGetValue(target, <span class="keyword">out</span> result))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">string</span> status = result ? <span class="string">&quot;成功&quot;</span> : <span class="string">&quot;失败&quot;</span>;</span><br><span class="line">                    resultBuilder.AppendLine(<span class="string">&quot;  &quot;</span> + target.PadRight(<span class="number">15</span>) + <span class="string">&quot; =&gt; &quot;</span> + status);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    resultBuilder.AppendLine(<span class="string">&quot;  &quot;</span> + target.PadRight(<span class="number">15</span>) + <span class="string">&quot; =&gt; 超时&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            LogInfo(resultBuilder.ToString());</span><br><span class="line">            LogInfo(<span class="string">&quot;PING检测统计: 成功 &quot;</span> + successCount + <span class="string">&quot;/&quot;</span> + _config.PingTargets.Count);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> successCount &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 并行执行HTTP测试</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 检测原理：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 使用HTTP HEAD方法请求网络连通性检测服务</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 这些服务通常返回204状态码或2xx状态码</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 只要返回2xx状态码就认为成功</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>true表示至少有一个HTTP请求成功，false表示全部失败<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">PerformHttpTestsParallel</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            LogInfo(<span class="string">&quot;开始并行HTTP测试 (目标数: &quot;</span> + _config.HttpTargets.Count + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">int</span> successCount = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">var</span> results = <span class="keyword">new</span> ConcurrentDictionary&lt;<span class="built_in">string</span>, <span class="built_in">bool</span>&gt;();</span><br><span class="line">            <span class="keyword">var</span> tasks = <span class="keyword">new</span> List&lt;Thread&gt;();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 为每个HTTP目标创建线程</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> url <span class="keyword">in</span> _config.HttpTargets)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> thread = <span class="keyword">new</span> Thread(() =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">bool</span> result = TestHttpConnectionFast(url);</span><br><span class="line">                    results[url] = result;</span><br><span class="line">                    <span class="keyword">if</span> (result)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Interlocked.Increment(<span class="keyword">ref</span> successCount);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">                thread.Start();</span><br><span class="line">                tasks.Add(thread);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 等待所有线程完成，最多等待HttpTimeoutMs毫秒</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> thread <span class="keyword">in</span> tasks)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!thread.Join(_config.HttpTimeoutMs))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 线程超时，强制终止</span></span><br><span class="line">                    thread.Abort();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 输出HTTP测试详细结果</span></span><br><span class="line">            <span class="keyword">var</span> resultBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            resultBuilder.AppendLine(<span class="string">&quot;HTTP检测详细结果:&quot;</span>);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> url <span class="keyword">in</span> _config.HttpTargets)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">bool</span> result;</span><br><span class="line">                <span class="keyword">if</span> (results.TryGetValue(url, <span class="keyword">out</span> result))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">string</span> status = result ? <span class="string">&quot;成功&quot;</span> : <span class="string">&quot;失败&quot;</span>;</span><br><span class="line">                    resultBuilder.AppendLine(<span class="string">&quot;  &quot;</span> + url + <span class="string">&quot; =&gt; &quot;</span> + status);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    resultBuilder.AppendLine(<span class="string">&quot;  &quot;</span> + url + <span class="string">&quot; =&gt; 超时&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            LogInfo(resultBuilder.ToString());</span><br><span class="line">            LogInfo(<span class="string">&quot;HTTP检测统计: 成功 &quot;</span> + successCount + <span class="string">&quot;/&quot;</span> + _config.HttpTargets.Count);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> successCount &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 快速Ping单个主机</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 优化点：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. 使用较短的超时时间(800ms)加快检测速度</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. 每次创建新的Ping实例，避免资源竞争</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. 简化异常处理，只返回成功/失败</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;host&quot;&gt;</span>目标主机IP地址<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>true表示Ping成功，false表示失败或超时<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">PingHostFast</span>(<span class="params"><span class="built_in">string</span> host</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">var</span> ping = <span class="keyword">new</span> Ping())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 使用较短的超时时间加快检测速度</span></span><br><span class="line">                    <span class="keyword">var</span> reply = ping.Send(host, <span class="number">800</span>);</span><br><span class="line">                    <span class="keyword">return</span> reply != <span class="literal">null</span> &amp;&amp; reply.Status == IPStatus.Success;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 发生任何异常都视为失败</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 快速测试HTTP连接</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 技术要点：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. 使用HEAD方法，只获取响应头，不下载内容</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. 设置较短的超时时间(2000ms)加快检测速度</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. 设置合适的User-Agent，避免被某些服务拒绝</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 4. 关闭KeepAlive，避免连接池影响</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;url&quot;&gt;</span>目标URL地址<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>true表示HTTP请求成功，false表示失败或超时<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">TestHttpConnectionFast</span>(<span class="params"><span class="built_in">string</span> url</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 创建HTTP请求</span></span><br><span class="line">                <span class="keyword">var</span> request = WebRequest.Create(url) <span class="keyword">as</span> HttpWebRequest;</span><br><span class="line">                <span class="keyword">if</span> (request == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 配置请求参数</span></span><br><span class="line">                request.Timeout = <span class="number">2000</span>;  <span class="comment">// 2秒超时</span></span><br><span class="line">                request.Method = <span class="string">&quot;HEAD&quot;</span>; <span class="comment">// 使用HEAD方法</span></span><br><span class="line">                request.UserAgent = <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span>;</span><br><span class="line">                request.Accept = <span class="string">&quot;*/*&quot;</span>;</span><br><span class="line">                request.KeepAlive = <span class="literal">false</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 发送请求并获取响应</span></span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">var</span> response = request.GetResponse() <span class="keyword">as</span> HttpWebResponse)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (response != <span class="literal">null</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 2xx状态码都视为成功</span></span><br><span class="line">                        <span class="keyword">return</span> (<span class="built_in">int</span>)response.StatusCode &gt;= <span class="number">200</span> &amp;&amp; (<span class="built_in">int</span>)response.StatusCode &lt;= <span class="number">299</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (WebException ex)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// WebException特殊处理：尝试获取响应状态码</span></span><br><span class="line">                <span class="keyword">if</span> (ex.Response != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">using</span> (<span class="keyword">var</span> response = ex.Response <span class="keyword">as</span> HttpWebResponse)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (response != <span class="literal">null</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// 即使发生WebException，如果返回2xx状态码也算成功</span></span><br><span class="line">                            <span class="keyword">return</span> (<span class="built_in">int</span>)response.StatusCode &gt;= <span class="number">200</span> &amp;&amp; (<span class="built_in">int</span>)response.StatusCode &lt;= <span class="number">299</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 其他异常都视为失败</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 用户活动检测</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 检测用户输入活动</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 检测原理：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. 通过Windows API获取系统最后输入时间</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. 计算当前时间与最后输入时间的差值</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. 如果差值小于阈值，则认为用户有活动</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 注意：只检测键盘和鼠标输入活动</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>true表示用户有输入活动，false表示用户空闲<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">HasUserInputActivity</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">uint</span> idleTimeMs = GetUserIdleTime();</span><br><span class="line">                <span class="built_in">uint</span> thresholdMs = (<span class="built_in">uint</span>)_config.UserIdleThresholdSeconds * <span class="number">1000</span>;</span><br><span class="line">                <span class="built_in">bool</span> hasActivity = idleTimeMs &lt; thresholdMs;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 记录详细的空闲时间信息</span></span><br><span class="line">                LogInfo(<span class="string">&quot;用户活动检测: &quot;</span> + (hasActivity ? <span class="string">&quot;有活动&quot;</span> : <span class="string">&quot;无活动&quot;</span>) + </span><br><span class="line">                       <span class="string">&quot; (空闲时间: &quot;</span> + (idleTimeMs / <span class="number">1000</span>) + <span class="string">&quot; 秒)&quot;</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> hasActivity;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 用户活动检测失败时，默认返回无活动（保守策略）</span></span><br><span class="line">                LogError(<span class="string">&quot;用户活动检测异常&quot;</span>, ex);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取用户空闲时间（毫秒）</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 实现方式：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. 调用GetLastInputInfo获取系统最后输入时间</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. 计算当前系统运行时间与最后输入时间的差值</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. 返回用户空闲的毫秒数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 注意：Environment.TickCount在49.7天后会回绕，但这里影响不大</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>用户空闲时间（毫秒）<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">uint</span> <span class="title">GetUserIdleTime</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> lastInputInfo = <span class="keyword">new</span> LASTINPUTINFO();</span><br><span class="line">            lastInputInfo.cbSize = (<span class="built_in">uint</span>)Marshal.SizeOf(lastInputInfo);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (GetLastInputInfo(<span class="keyword">ref</span> lastInputInfo))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 计算空闲时间 = 当前时间 - 最后输入时间</span></span><br><span class="line">                <span class="keyword">return</span> (<span class="built_in">uint</span>)Environment.TickCount - lastInputInfo.dwTime;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// API调用失败时返回最大值，表示用户已长时间空闲</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">uint</span>.MaxValue;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 关机操作</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 执行关机操作</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 执行步骤：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. 检查管理员权限</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. 使用shutdown.exe执行关机命令</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. 设置立即关机(/s /f /t 0)</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 参数说明：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> /s: 关机</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> /f: 强制关闭所有应用程序</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> /t 0: 延迟0秒</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ExecuteShutdown</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                LogWarning(<span class="string">&quot;已达到关机条件，准备执行关机操作&quot;</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 权限检查：关机需要管理员权限</span></span><br><span class="line">                <span class="keyword">if</span> (!IsRunningAsAdministrator())</span><br><span class="line">                &#123;</span><br><span class="line">                    LogError(<span class="string">&quot;执行关机操作需要管理员权限，请以管理员身份运行本程序&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 配置关机命令参数</span></span><br><span class="line">                <span class="keyword">var</span> psi = <span class="keyword">new</span> ProcessStartInfo</span><br><span class="line">                &#123;</span><br><span class="line">                    FileName = <span class="string">&quot;shutdown.exe&quot;</span>,</span><br><span class="line">                    Arguments = <span class="string">&quot;/s /f /t 0&quot;</span>,</span><br><span class="line">                    CreateNoWindow = <span class="literal">true</span>,</span><br><span class="line">                    UseShellExecute = <span class="literal">false</span></span><br><span class="line">                &#125;;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 执行关机命令</span></span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">var</span> process = Process.Start(psi))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 等待命令执行</span></span><br><span class="line">                    Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                LogWarning(<span class="string">&quot;关机命令已发送，系统将立即关闭&quot;</span>);</span><br><span class="line">                Stop(); <span class="comment">// 停止程序主循环</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                LogError(<span class="string">&quot;执行关机操作失败&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 检查是否以管理员权限运行</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 实现方式：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. 获取当前Windows身份标识</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. 检查是否属于Administrators组</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 注意：Windows Vista及以上版本需要UAC提升</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>true表示以管理员权限运行，false表示不是管理员<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">IsRunningAsAdministrator</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> identity = System.Security.Principal.WindowsIdentity.GetCurrent();</span><br><span class="line">                <span class="keyword">var</span> principal = <span class="keyword">new</span> System.Security.Principal.WindowsPrincipal(identity);</span><br><span class="line">                <span class="keyword">return</span> principal.IsInRole(System.Security.Principal.WindowsBuiltInRole.Administrator);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 权限检查失败时，默认返回false（保守策略）</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 日志输出</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 输出程序标题和配置信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PrintBanner</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;网络空闲关机程序 - NetIdleShutdown&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;版本: 1.0&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;作者: System&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;功能说明:&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- 当网络断开且用户无操作时，自动执行关机&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- 检测策略: 双重检测 (Ping + HTTP)&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- 检测方式: 并行多线程检测&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;当前配置:&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- 无网络关机阈值: &quot;</span> + _config.MaxNoNetMinutes + <span class="string">&quot; 分钟&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- 检测间隔: &quot;</span> + _config.CheckIntervalSeconds + <span class="string">&quot; 秒&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- 用户空闲阈值: &quot;</span> + _config.UserIdleThresholdSeconds + <span class="string">&quot; 秒&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- Ping检测目标: &quot;</span> + _config.PingTargets.Count + <span class="string">&quot; 个&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;- HTTP检测目标: &quot;</span> + _config.HttpTargets.Count + <span class="string">&quot; 个&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 记录信息级别日志</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用于记录程序正常运行状态信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;message&quot;&gt;</span>日志消息<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LogInfo</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [INFO] &quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 记录警告级别日志</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用于记录需要注意但不影响程序继续运行的情况</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;message&quot;&gt;</span>日志消息<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LogWarning</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [WARN] &quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 记录错误级别日志</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用于记录程序运行中的错误和异常</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;message&quot;&gt;</span>日志消息<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ex&quot;&gt;</span>异常对象（可选）<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LogError</span>(<span class="params"><span class="built_in">string</span> message, Exception ex = <span class="literal">null</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [ERROR] &quot;</span> + message);</span><br><span class="line">            <span class="keyword">if</span> (ex != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [ERROR] 异常类型: &quot;</span> + ex.GetType().Name);</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [ERROR] 异常消息: &quot;</span> + ex.Message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 资源清理</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 释放程序资源</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 实现IDisposable接口，支持using语句</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            _isRunning = <span class="literal">false</span>;</span><br><span class="line">            LogInfo(<span class="string">&quot;程序资源已释放&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 程序主入口类</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 包含Main方法和程序启动逻辑</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 应用程序主入口点</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 主要流程：</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 1. 创建NetIdleShutdown实例</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 2. 设置Ctrl+C中断处理</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 3. 运行网络检测主循环</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 4. 处理异常并优雅退出</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;args&quot;&gt;</span>命令行参数（当前版本未使用）<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [SYSTEM] 程序启动中...&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> shutdown = <span class="keyword">new</span> NetIdleShutdown())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 设置控制台关闭事件处理（Ctrl+C）</span></span><br><span class="line">                Console.CancelKeyPress += (sender, e) =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [SYSTEM] 收到中断信号，正在停止程序...&quot;</span>);</span><br><span class="line">                    shutdown.Stop();</span><br><span class="line">                    e.Cancel = <span class="literal">true</span>; <span class="comment">// 防止程序立即退出</span></span><br><span class="line">                &#125;;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [SYSTEM] 程序已启动，开始网络监控&quot;</span>);</span><br><span class="line">                    shutdown.Run();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [SYSTEM] 程序运行失败: &quot;</span> + ex.Message);</span><br><span class="line">                    Environment.Exit(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine(<span class="string">&quot;[&quot;</span> + DateTime.Now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class="string">&quot;] [SYSTEM] 程序已退出&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>成品 <a target="_blank" rel="noopener" href="https://github.com/utgnim/NetIdleShutdown.cs/raw/refs/heads/master/NetIdleShutdown.cs">NetIdleShutdown.cs</a></p>
<p>3 分钟版 <a target="_blank" rel="noopener" href="https://github.com/utgnim/NetIdleShutdown.cs/raw/refs/heads/master/3minNetIdleShutdown.exe">3minNetIdleShutdown.exe</a></p>
<p>30 分钟版 <a target="_blank" rel="noopener" href="https://github.com/utgnim/NetIdleShutdown.cs/raw/refs/heads/master/30minNetIdleShutdown.exe">30minNetIdleShutdown.exe</a></p>
<p>GitHub地址 <a target="_blank" rel="noopener" href="https://github.com/utgnim/NetIdleShutdown.cs.git">https://github.com/utgnim/NetIdleShutdown.cs.git</a></p>

    </div>
</article>


                </div>
                <aside class="col-md-4 gal-left" id="sidebar">
    <!-- 此为sidebar的搜索框, 非搜索结果页面 -->
<aside id="sidebar-search">
    <div class="search hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <form class="form-inline clearfix" id="search-form" method="get"
              action="/sukebei/search/index.html">
            <input type="text" name="s" class="form-control" id="searchInput" placeholder="搜索文章~" autocomplete="off">
            <button class="btn btn-danger btn-gal" type="submit">
                <i class="fa fa-search"></i>
            </button>
        </form>
    </div>
</aside>
    <aside id="sidebar-author">
    <div class="panel panel-gal" data-aos="flip-right" data-aos-duration="3000">
        <div class="panel-heading" style="text-align: center">
            <i class="fa fa-quote-left"></i>
            Mingtu2019
            <i class="fa fa-quote-right"></i>
        </div>
        <div class="author-panel text-center">
            <img src="/sukebei/imgs/49590221.png" width="140" height="140"
                 alt="个人头像" class="author-image">
            <p class="author-description"></p>
        </div>
    </div>
</aside>
    
    
    <!-- 要配置好leancloud才能开启此小工具 -->
    
    
    <aside id="sidebar-recent_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            近期文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%9C%89%E6%84%8F%E6%80%9D%E7%9A%84%E9%A1%B9%E7%9B%AE/">有意思的项目</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E5%85%B3%E4%BA%8E%E6%B1%BD%E8%BD%A6/">关于汽车</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E4%BA%8C%E5%8D%81%E5%9B%9B/">浮生六记-卷一-闺房记乐-二十四</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E4%BA%8C%E5%8D%81%E4%B8%89/">浮生六记-卷一-闺房记乐-二十三</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">常用命令</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E7%8E%B0%E8%B1%A1%E4%B8%83%E5%8D%81%E4%BA%8C%E5%8F%98/">现象七十二变</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/NetIdleShutdown-%E6%97%A0%E7%BD%91%E7%BB%9C%E6%97%A0%E6%93%8D%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%85%B3%E6%9C%BA%E5%B0%8F%E7%A8%8B%E5%BA%8F-C/">NetIdleShutdown 无网络无操作自动关机小程序[C#]</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E4%BA%8C%E5%8D%81%E4%BA%8C/">浮生六记-卷一-闺房记乐-二十二</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E5%85%B3%E4%BA%8E-Windows-Server-2022-%E5%AE%89%E8%A3%85%E5%9C%A8%E7%AC%94%E8%AE%B0%E6%9C%AC%E4%B8%8A%E4%B8%80%E4%BA%9B%E5%86%85%E5%AE%B9%E6%95%B4%E7%90%86%E5%8F%82%E8%80%83/">关于 Windows Server 2022 安装在笔记本上一些内容整理参考</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E8%AF%84%E6%99%AE%E9%B2%81%E5%A3%AB%E6%9C%80%E8%BF%91%E7%9A%84%E4%B9%A6%E6%8A%A5%E6%A3%80%E6%9F%A5%E4%BB%A4/">评普鲁士最近的书报检查令</a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="sidebar-rand_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            随机文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E5%85%B3%E4%BA%8E-Windows-Server-2022-%E5%AE%89%E8%A3%85%E5%9C%A8%E7%AC%94%E8%AE%B0%E6%9C%AC%E4%B8%8A%E4%B8%80%E4%BA%9B%E5%86%85%E5%AE%B9%E6%95%B4%E7%90%86%E5%8F%82%E8%80%83/">关于 Windows Server 2022 安装在笔记本上一些内容整理参考</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%90%AD%E5%BB%BA-Hexo-%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/">搭建 Hexo 静态博客参考资料</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%96%B0%E6%A6%82%E5%BF%B5%E8%8B%B1%E8%AF%AD-%E7%AC%AC-1-%E5%86%8C/">新概念英语 - 第 1 册</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%9C%89%E6%84%8F%E6%80%9D%E7%9A%84%E9%A1%B9%E7%9B%AE/">有意思的项目</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E4%BA%8C%E5%8D%81%E4%B8%80/">浮生六记 - 卷一 闺房记乐 二十一</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E6%8B%BE%E4%B8%89/">浮生六记 - 卷一 闺房记乐 拾三</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E6%8B%BE%E4%BA%94/">浮生六记 - 卷一 闺房记乐 拾五</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E6%B5%AE%E7%94%9F%E5%85%AD%E8%AE%B0-%E5%8D%B7%E4%B8%80-%E9%97%BA%E6%88%BF%E8%AE%B0%E4%B9%90-%E6%8B%BE%E7%8E%96/">浮生六记 - 卷一 闺房记乐 拾玖</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E7%8E%B0%E8%B1%A1%E4%B8%83%E5%8D%81%E4%BA%8C%E5%8F%98/">现象七十二变</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/sukebei/%E8%AF%84%E6%99%AE%E9%B2%81%E5%A3%AB%E6%9C%80%E8%BF%91%E7%9A%84%E4%B9%A6%E6%8A%A5%E6%A3%80%E6%9F%A5%E4%BB%A4/">评普鲁士最近的书报检查令</a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
</aside>
            </div>
        </div>
    </div>
    <footer id="gal-footer">
    <div class="container">
        Copyright © 2018 Mingtu2019 Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/ZEROKISEKI" target="_blank">AONOSORA</a>
    </div>
</footer>

<!-- 回到顶端 -->
<div id="gal-gotop">
    <i class="fa fa-angle-up"></i>
</div>
    
    
    <script src="/js/clipboard/clipboard.min.js"></script>
    <script src="/js/custom.js"></script>
    
</body>

<script src="/sukebei/js/activate-power-mode.js"></script>

<script>

    // 配置highslide
	hs.graphicsDir = '/js/highslide/graphics/'
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.lang.number = '共%2张图, 当前是第%1张';
    hs.addSlideshow({
      interval: 5000,
      repeat: true,
      useControls: true,
      fixedControls: "fit",
      overlayOptions: {
        opacity: 0.75,
        position: "bottom center",
        hideOnMouseOut: true
      }
    })

    // 初始化aos
    AOS.init({
      duration: 1000,
      delay: 0,
      easing: 'ease-out-back'
    });

</script>
<script>
  POWERMODE.colorful = 'true';    // make power mode colorful
  POWERMODE.shake = 'true';          // enable/disable shake
	// TODO 这里根据具体情况修改
	document.body.addEventListener('input', POWERMODE);
</script>
<script>
    window.slideConfig = {
      prefix: '/sukebei/imgs/slide/background',
      ext: 'jpg',
      maxCount: '712'
    }
</script>

<script src="/sukebei/js/hs.js"></script>
<script src="/sukebei/js/blog.js"></script>



<script src="/sukebei/js/oni.js"></script>




</html>