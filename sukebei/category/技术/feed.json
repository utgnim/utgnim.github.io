{
    "version": "https://jsonfeed.org/version/1",
    "title": "It's a blog • All posts by \"技术\" category",
    "description": "",
    "home_page_url": "https://utgnim.github.io/sukebei",
    "items": [
        {
            "id": "https://utgnim.github.io/sukebei/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/",
            "url": "https://utgnim.github.io/sukebei/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/",
            "title": "常用命令",
            "date_published": "2026-02-15T10:06:24.000Z",
            "content_html": "<h2 id=\"Git-配置终端识别名\"><a href=\"#Git-配置终端识别名\" class=\"headerlink\" title=\"Git 配置终端识别名\"></a>Git 配置终端识别名</h2><blockquote>\n<p>git config –global user.email “youremail”</p>\n<p>git config –global user.name “yourname”</p>\n</blockquote>\n<h2 id=\"Git-生成-SSH-KEY-并授权-GitHub-项目处理权限\"><a href=\"#Git-生成-SSH-KEY-并授权-GitHub-项目处理权限\" class=\"headerlink\" title=\"Git 生成 SSH KEY 并授权 GitHub 项目处理权限\"></a>Git 生成 SSH KEY 并授权 GitHub 项目处理权限</h2><blockquote>\n<p>ssh-keygen -t ed25519 -C “<a href=\"mailto:&#121;&#x6f;&#x75;&#x72;&#x6e;&#x61;&#109;&#101;&#64;&#101;&#109;&#x61;&#105;&#x6c;&#46;&#x63;&#111;&#x6d;\">&#121;&#x6f;&#x75;&#x72;&#x6e;&#x61;&#109;&#101;&#64;&#101;&#109;&#x61;&#105;&#x6c;&#46;&#x63;&#111;&#x6d;</a>“</p>\n<p>cat ~&#x2F;.ssh&#x2F;id_ed25519.pub</p>\n<p>将公钥填写到 GitHub 设置中</p>\n<p>ssh -T <a href=\"mailto:&#103;&#x69;&#116;&#x40;&#x67;&#x69;&#x74;&#104;&#x75;&#98;&#46;&#99;&#111;&#x6d;\">&#103;&#x69;&#116;&#x40;&#x67;&#x69;&#x74;&#104;&#x75;&#98;&#46;&#99;&#111;&#x6d;</a></p>\n<p>测试连接</p>\n</blockquote>\n<h2 id=\"Git-中显示中文而非转义序列\"><a href=\"#Git-中显示中文而非转义序列\" class=\"headerlink\" title=\"Git 中显示中文而非转义序列\"></a>Git 中显示中文而非转义序列</h2><blockquote>\n<p>git config –global core.quotepath false</p>\n</blockquote>\n<h2 id=\"Git-配置代理和取消代理\"><a href=\"#Git-配置代理和取消代理\" class=\"headerlink\" title=\"Git 配置代理和取消代理\"></a>Git 配置代理和取消代理</h2><blockquote>\n<p>git config –global http.proxy <a href=\"http://127.0.0.1:7890/\">http://127.0.0.1:7890</a></p>\n<p>git config –global https.proxy <a href=\"http://127.0.0.1:7890/\">http://127.0.0.1:7890</a></p>\n<p>git config –global –unset-all http.proxy</p>\n<p>git config –global –unset-all https.proxy</p>\n</blockquote>\n<h2 id=\"Git-添加仓库地址，替换仓库地址\"><a href=\"#Git-添加仓库地址，替换仓库地址\" class=\"headerlink\" title=\"Git 添加仓库地址，替换仓库地址\"></a>Git 添加仓库地址，替换仓库地址</h2><blockquote>\n<p>git remote add origin <a href=\"https://github.com/utgnim/____.git\">https://github.com/utgnim/____.git</a></p>\n<p>git remote set-url origin <a href=\"https://github.com/utgnim/_____.git\">https://github.com/utgnim/_____.git</a></p>\n</blockquote>\n<h2 id=\"Hexo-命令\"><a href=\"#Hexo-命令\" class=\"headerlink\" title=\"Hexo 命令\"></a>Hexo 命令</h2><blockquote>\n<p>hexo –config _config.yml g &amp; hexo –config _config_gal.yml g</p>\n</blockquote>\n",
            "tags": [
                "技术"
            ]
        },
        {
            "id": "https://utgnim.github.io/sukebei/NetIdleShutdown-%E6%97%A0%E7%BD%91%E7%BB%9C%E6%97%A0%E6%93%8D%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%85%B3%E6%9C%BA%E5%B0%8F%E7%A8%8B%E5%BA%8F-C/",
            "url": "https://utgnim.github.io/sukebei/NetIdleShutdown-%E6%97%A0%E7%BD%91%E7%BB%9C%E6%97%A0%E6%93%8D%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%85%B3%E6%9C%BA%E5%B0%8F%E7%A8%8B%E5%BA%8F-C/",
            "title": "NetIdleShutdown 无网络无操作自动关机小程序[C#]",
            "date_published": "2026-02-13T10:16:11.000Z",
            "content_html": "<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>远程操控位于家中的电脑时，偶尔会遇到路由器或光猫当机的情况，网络突然断开，电脑却还没关机，只能等待下次断电路由器或光猫重启才能重新连接上电脑，这就非常耗电，于是有了这个小工具！</p>\n<h2 id=\"过程\"><a href=\"#过程\" class=\"headerlink\" title=\"过程\"></a>过程</h2><p>由于本人十分的菜，尽管也曾憧憬过成为一个程序员，但一直三分热度、半途而废，到最后不了了之。所以你可以猜到代码并不是我写的。</p>\n<p>代码由 Gemini 提供思路，DeepSeek 写成，经历了大约三天的时间，期间不断的请 AI 修改、编译，手动测试，最后终于能够成功运行。经初步短期测试，应该没有什么大问题，故分享出来，代码<code>NetIdleShutdown.cs</code>如下：</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Diagnostics;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Net.NetworkInformation;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Threading;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Runtime.InteropServices;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Collections.Concurrent;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Collections.Generic;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Text;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Net;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Linq;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">NetIdleShutdown</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 网络空闲关机程序</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 主要功能：</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 1. 检测网络连接状态（双重检测：Ping + HTTP）</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 2. 检测用户活动状态</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 3. 当网络断开且用户无操作时，自动执行关机操作</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 检测逻辑：</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> - 使用并行线程同时检测多个目标，提高检测速度</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> - 如果所有Ping目标都失败，则直接判断为网络离线</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> - 如果有至少一个Ping成功，则继续进行HTTP检测</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> - 必须同时满足Ping和HTTP检测都至少有一个成功，才判断为在线</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 配置说明：</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> - 程序默认配置在AppConfig类中</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> - 可修改默认值或通过构造函数传入自定义配置</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">NetIdleShutdown</span> : <span class=\"title\">IDisposable</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> 配置类</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 应用程序配置类</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 包含所有可配置的参数和检测目标列表</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">AppConfig</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 核心配置参数</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"built_in\">int</span> MaxNoNetMinutes = <span class=\"number\">3</span>;           <span class=\"comment\">// 无网络多少分钟后关机</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"built_in\">int</span> PingTimeoutMs = <span class=\"number\">1500</span>;          <span class=\"comment\">// Ping超时时间（毫秒）- 控制线程等待时间</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"built_in\">int</span> HttpTimeoutMs = <span class=\"number\">5000</span>;          <span class=\"comment\">// HTTP请求超时时间（毫秒）- 控制线程等待时间</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"built_in\">int</span> CheckIntervalSeconds = <span class=\"number\">60</span>;     <span class=\"comment\">// 检测间隔时间（秒）- 主循环等待时间</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"built_in\">int</span> UserIdleThresholdSeconds = <span class=\"number\">60</span>; <span class=\"comment\">// 用户空闲时间阈值（秒）- 判定用户无活动的阈值</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 检测目标列表</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> List&lt;<span class=\"built_in\">string</span>&gt; PingTargets;  <span class=\"comment\">// Ping检测目标IP地址列表</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> List&lt;<span class=\"built_in\">string</span>&gt; HttpTargets;  <span class=\"comment\">// HTTP检测目标URL列表</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">            <span class=\"comment\"><span class=\"doctag\">///</span> 构造函数，初始化默认配置和检测目标</span></span><br><span class=\"line\">            <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AppConfig</span>()</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 初始化Ping检测目标列表</span></span><br><span class=\"line\">                <span class=\"comment\">// 包含国内外常用的公共DNS服务器，提高检测可靠性</span></span><br><span class=\"line\">                PingTargets = <span class=\"keyword\">new</span> List&lt;<span class=\"built_in\">string</span>&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;223.5.5.5&quot;</span>,        <span class=\"comment\">// 阿里DNS - 国内常用</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;119.29.29.29&quot;</span>,     <span class=\"comment\">// 腾讯DNS - 国内常用</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;180.76.76.76&quot;</span>,     <span class=\"comment\">// 百度DNS - 国内常用</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;1.1.1.1&quot;</span>,          <span class=\"comment\">// Cloudflare DNS - 国际常用</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;8.8.8.8&quot;</span>,          <span class=\"comment\">// Google DNS - 国际常用</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;114.114.114.114&quot;</span>,  <span class=\"comment\">// 114DNS - 国内常用</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;208.67.222.222&quot;</span>,   <span class=\"comment\">// OpenDNS - 国际备用</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;9.9.9.9&quot;</span>           <span class=\"comment\">// Quad9 DNS - 国际备用</span></span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 初始化HTTP检测目标列表</span></span><br><span class=\"line\">                <span class=\"comment\">// 使用各大公司的网络连通性检测服务，通常返回204状态码</span></span><br><span class=\"line\">                HttpTargets = <span class=\"keyword\">new</span> List&lt;<span class=\"built_in\">string</span>&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;http://connect.rom.miui.com/generate_204&quot;</span>,          <span class=\"comment\">// 小米网络检测服务</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;http://connectivitycheck.gstatic.com/generate_204&quot;</span>, <span class=\"comment\">// Google网络检测服务</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;http://www.gstatic.com/generate_204&quot;</span>,               <span class=\"comment\">// Google备用检测服务</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;http://www.msftncsi.com/ncsi.txt&quot;</span>,                  <span class=\"comment\">// Microsoft网络检测服务</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;http://captive.apple.com/hotspot-detect.html&quot;</span>,      <span class=\"comment\">// Apple网络检测服务</span></span><br><span class=\"line\">                    <span class=\"string\">&quot;http://connectivitycheck.platform.hicloud.com/generate_204&quot;</span> <span class=\"comment\">// 华为网络检测服务</span></span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> Windows API声明</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 获取系统最后输入时间的Windows API函数</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 用于检测用户活动状态</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;plii&quot;&gt;</span>LASTINPUTINFO结构体引用<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>获取成功返回true，失败返回false<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">        [<span class=\"meta\">DllImport(<span class=\"string\">&quot;user32.dll&quot;</span>)</span>]</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">extern</span> <span class=\"built_in\">bool</span> <span class=\"title\">GetLastInputInfo</span>(<span class=\"params\"><span class=\"keyword\">ref</span> LASTINPUTINFO plii</span>)</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 最后输入信息结构体</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 用于存储用户最后输入的时间信息</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        [<span class=\"meta\">StructLayout(LayoutKind.Sequential)</span>]</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">struct</span> LASTINPUTINFO</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"built_in\">uint</span> cbSize;    <span class=\"comment\">// 结构体大小</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"built_in\">uint</span> dwTime;    <span class=\"comment\">// 最后输入时间（系统启动后的毫秒数）</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> 私有字段</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">readonly</span> AppConfig _config;                <span class=\"comment\">// 程序配置实例</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"built_in\">int</span> _noNetCounter = <span class=\"number\">0</span>;                     <span class=\"comment\">// 无网络计数器</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> _isRunning = <span class=\"literal\">true</span>;                    <span class=\"comment\">// 程序运行标志</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">readonly</span> <span class=\"built_in\">object</span> _counterLock = <span class=\"keyword\">new</span> <span class=\"built_in\">object</span>(); <span class=\"comment\">// 计数器同步锁</span></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> 构造函数</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 构造函数</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;config&quot;&gt;</span>自定义配置，如果为null则使用默认配置<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">NetIdleShutdown</span>(<span class=\"params\">AppConfig config = <span class=\"literal\">null</span></span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 使用传入的配置或创建默认配置</span></span><br><span class=\"line\">            _config = config ?? <span class=\"keyword\">new</span> AppConfig();</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 记录配置信息</span></span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;[SYSTEM] 程序配置已加载&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;[SYSTEM] 无网络关机阈值: &quot;</span> + _config.MaxNoNetMinutes + <span class=\"string\">&quot; 分钟&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;[SYSTEM] 检测间隔: &quot;</span> + _config.CheckIntervalSeconds + <span class=\"string\">&quot; 秒&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;[SYSTEM] 用户空闲阈值: &quot;</span> + _config.UserIdleThresholdSeconds + <span class=\"string\">&quot; 秒&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> 主程序入口</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 启动网络守护程序主循环</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Run</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 显示程序标题和配置信息</span></span><br><span class=\"line\">                PrintBanner();</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 主循环：持续检测网络和用户状态</span></span><br><span class=\"line\">                <span class=\"keyword\">while</span> (_isRunning)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 执行一次完整的检测周期</span></span><br><span class=\"line\">                    PerformCheckCycle();</span><br><span class=\"line\">                    </span><br><span class=\"line\">                    <span class=\"comment\">// 等待指定的间隔时间，每秒检查一次是否停止</span></span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; _config.CheckIntervalSeconds &amp;&amp; _isRunning; i++)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        Thread.Sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span> (Exception ex)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 记录严重错误并重新抛出</span></span><br><span class=\"line\">                LogError(<span class=\"string\">&quot;程序运行异常&quot;</span>, ex);</span><br><span class=\"line\">                <span class=\"keyword\">throw</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 停止守护程序</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 设置运行标志为false，使主循环退出</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Stop</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            _isRunning = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            LogInfo(<span class=\"string\">&quot;程序已收到停止指令&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> 检测周期</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 执行一个完整的检测周期</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 包括网络检测、用户活动检测和状态处理</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">PerformCheckCycle</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> timestamp = DateTime.Now;</span><br><span class=\"line\">            LogInfo(<span class=\"string\">&quot;开始第 &quot;</span> + (_noNetCounter + <span class=\"number\">1</span>) + <span class=\"string\">&quot; 次检测&quot;</span>);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 检测网络连接状态</span></span><br><span class=\"line\">            <span class=\"built_in\">bool</span> isOnline = CheckConnectivity();</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 根据网络状态进行相应处理</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isOnline)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                HandleOnlineStatus(timestamp);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                HandleOfflineStatus(timestamp);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 处理在线状态</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 网络正常时重置计数器并记录状态</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;timestamp&quot;&gt;</span>检测时间戳<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">HandleOnlineStatus</span>(<span class=\"params\">DateTime timestamp</span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">lock</span> (_counterLock)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 如果之前有离线记录，则重置计数器</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (_noNetCounter &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    LogInfo(<span class=\"string\">&quot;网络恢复正常，无网络计数器已重置&quot;</span>);</span><br><span class=\"line\">                    _noNetCounter = <span class=\"number\">0</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            LogInfo(<span class=\"string\">&quot;网络状态: 在线&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 处理离线状态</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 网络断开时检查用户活动并更新计数器</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;timestamp&quot;&gt;</span>检测时间戳<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">HandleOfflineStatus</span>(<span class=\"params\">DateTime timestamp</span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 检测用户是否有输入活动</span></span><br><span class=\"line\">            <span class=\"built_in\">bool</span> hasUserActivity = HasUserInputActivity();</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> (hasUserActivity)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 有用户活动，重置计数器</span></span><br><span class=\"line\">                <span class=\"keyword\">lock</span> (_counterLock)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (_noNetCounter &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        LogInfo(<span class=\"string\">&quot;检测到用户活动，无网络计数器已重置&quot;</span>);</span><br><span class=\"line\">                        _noNetCounter = <span class=\"number\">0</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                LogInfo(<span class=\"string\">&quot;网络状态: 离线 (用户活动中，不计数)&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 无用户活动，增加计数器</span></span><br><span class=\"line\">                <span class=\"keyword\">lock</span> (_counterLock)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    _noNetCounter++;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                </span><br><span class=\"line\">                LogInfo(<span class=\"string\">&quot;网络状态: 离线&quot;</span>);</span><br><span class=\"line\">                LogInfo(<span class=\"string\">&quot;无网络计数器: &quot;</span> + _noNetCounter + <span class=\"string\">&quot;/&quot;</span> + _config.MaxNoNetMinutes);</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 检查是否达到关机条件</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (_noNetCounter &gt;= _config.MaxNoNetMinutes)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    ExecuteShutdown();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> 网络检测</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 检测网络连接状态</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 检测逻辑：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 1. 并行执行Ping检测</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 2. 如果所有Ping目标都失败，直接判断为离线</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 3. 如果至少有一个Ping成功，则继续进行HTTP检测</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 4. 必须同时满足Ping和HTTP检测都至少有一个成功，才判断为在线</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 优化：网络完全断开时，最快800ms即可判断为离线</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>true表示网络在线，false表示网络离线<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> <span class=\"title\">CheckConnectivity</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            LogInfo(<span class=\"string\">&quot;开始网络连通性检测&quot;</span>);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 第一步：并行执行Ping检测</span></span><br><span class=\"line\">            <span class=\"built_in\">bool</span> pingSuccess = PerformPingTestsParallel();</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 第二步：如果Ping检测全部失败，直接判断为离线</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!pingSuccess)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                LogInfo(<span class=\"string\">&quot;Ping检测结果: 全部失败，直接判定为网络离线&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 第三步：Ping检测通过，继续进行HTTP检测</span></span><br><span class=\"line\">            LogInfo(<span class=\"string\">&quot;Ping检测结果: 至少有一个成功，开始HTTP检测&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">bool</span> httpSuccess = PerformHttpTestsParallel();</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 第四步：必须同时满足Ping和HTTP检测都成功</span></span><br><span class=\"line\">            <span class=\"built_in\">bool</span> finalResult = pingSuccess &amp;&amp; httpSuccess;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 记录详细检测结果</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (finalResult)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                LogInfo(<span class=\"string\">&quot;网络检测最终结果: 在线 (Ping和HTTP检测均通过)&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                LogInfo(<span class=\"string\">&quot;网络检测最终结果: 离线 (Ping: &quot;</span> + (pingSuccess ? <span class=\"string\">&quot;成功&quot;</span> : <span class=\"string\">&quot;失败&quot;</span>) + </span><br><span class=\"line\">                       <span class=\"string\">&quot;, HTTP: &quot;</span> + (httpSuccess ? <span class=\"string\">&quot;成功&quot;</span> : <span class=\"string\">&quot;失败&quot;</span>) + <span class=\"string\">&quot;)&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">return</span> finalResult;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 并行执行Ping测试</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 实现方式：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 1. 为每个Ping目标创建一个独立线程</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 2. 所有线程同时执行，提高检测速度</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 3. 使用ConcurrentDictionary存储线程安全的结果</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 4. 使用Interlocked.Increment保证计数器的线程安全</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 超时控制：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 每个线程最多等待PingTimeoutMs毫秒</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 超时线程将被强制终止</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>true表示至少有一个Ping成功，false表示全部失败<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> <span class=\"title\">PerformPingTestsParallel</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            LogInfo(<span class=\"string\">&quot;开始并行Ping测试 (目标数: &quot;</span> + _config.PingTargets.Count + <span class=\"string\">&quot;)&quot;</span>);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"built_in\">int</span> successCount = <span class=\"number\">0</span>;  <span class=\"comment\">// 成功计数器</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> results = <span class=\"keyword\">new</span> ConcurrentDictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">bool</span>&gt;();  <span class=\"comment\">// 结果存储</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> tasks = <span class=\"keyword\">new</span> List&lt;Thread&gt;();  <span class=\"comment\">// 线程列表</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 为每个Ping目标创建线程</span></span><br><span class=\"line\">            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> target <span class=\"keyword\">in</span> _config.PingTargets)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> thread = <span class=\"keyword\">new</span> Thread(() =&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">bool</span> result = PingHostFast(target);</span><br><span class=\"line\">                    results[target] = result;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (result)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        Interlocked.Increment(<span class=\"keyword\">ref</span> successCount);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                </span><br><span class=\"line\">                thread.Start();</span><br><span class=\"line\">                tasks.Add(thread);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 等待所有线程完成，最多等待PingTimeoutMs毫秒</span></span><br><span class=\"line\">            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> thread <span class=\"keyword\">in</span> tasks)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!thread.Join(_config.PingTimeoutMs))</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 线程超时，强制终止</span></span><br><span class=\"line\">                    thread.Abort();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 输出Ping测试详细结果</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> resultBuilder = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">            resultBuilder.AppendLine(<span class=\"string\">&quot;PING检测详细结果:&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> target <span class=\"keyword\">in</span> _config.PingTargets)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"built_in\">bool</span> result;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (results.TryGetValue(target, <span class=\"keyword\">out</span> result))</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">string</span> status = result ? <span class=\"string\">&quot;成功&quot;</span> : <span class=\"string\">&quot;失败&quot;</span>;</span><br><span class=\"line\">                    resultBuilder.AppendLine(<span class=\"string\">&quot;  &quot;</span> + target.PadRight(<span class=\"number\">15</span>) + <span class=\"string\">&quot; =&gt; &quot;</span> + status);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">else</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    resultBuilder.AppendLine(<span class=\"string\">&quot;  &quot;</span> + target.PadRight(<span class=\"number\">15</span>) + <span class=\"string\">&quot; =&gt; 超时&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            LogInfo(resultBuilder.ToString());</span><br><span class=\"line\">            LogInfo(<span class=\"string\">&quot;PING检测统计: 成功 &quot;</span> + successCount + <span class=\"string\">&quot;/&quot;</span> + _config.PingTargets.Count);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">return</span> successCount &gt; <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 并行执行HTTP测试</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 检测原理：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 使用HTTP HEAD方法请求网络连通性检测服务</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 这些服务通常返回204状态码或2xx状态码</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 只要返回2xx状态码就认为成功</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>true表示至少有一个HTTP请求成功，false表示全部失败<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> <span class=\"title\">PerformHttpTestsParallel</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            LogInfo(<span class=\"string\">&quot;开始并行HTTP测试 (目标数: &quot;</span> + _config.HttpTargets.Count + <span class=\"string\">&quot;)&quot;</span>);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"built_in\">int</span> successCount = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> results = <span class=\"keyword\">new</span> ConcurrentDictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">bool</span>&gt;();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> tasks = <span class=\"keyword\">new</span> List&lt;Thread&gt;();</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 为每个HTTP目标创建线程</span></span><br><span class=\"line\">            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> url <span class=\"keyword\">in</span> _config.HttpTargets)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> thread = <span class=\"keyword\">new</span> Thread(() =&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">bool</span> result = TestHttpConnectionFast(url);</span><br><span class=\"line\">                    results[url] = result;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (result)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        Interlocked.Increment(<span class=\"keyword\">ref</span> successCount);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                </span><br><span class=\"line\">                thread.Start();</span><br><span class=\"line\">                tasks.Add(thread);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 等待所有线程完成，最多等待HttpTimeoutMs毫秒</span></span><br><span class=\"line\">            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> thread <span class=\"keyword\">in</span> tasks)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!thread.Join(_config.HttpTimeoutMs))</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 线程超时，强制终止</span></span><br><span class=\"line\">                    thread.Abort();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 输出HTTP测试详细结果</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> resultBuilder = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">            resultBuilder.AppendLine(<span class=\"string\">&quot;HTTP检测详细结果:&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> url <span class=\"keyword\">in</span> _config.HttpTargets)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"built_in\">bool</span> result;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (results.TryGetValue(url, <span class=\"keyword\">out</span> result))</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">string</span> status = result ? <span class=\"string\">&quot;成功&quot;</span> : <span class=\"string\">&quot;失败&quot;</span>;</span><br><span class=\"line\">                    resultBuilder.AppendLine(<span class=\"string\">&quot;  &quot;</span> + url + <span class=\"string\">&quot; =&gt; &quot;</span> + status);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">else</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    resultBuilder.AppendLine(<span class=\"string\">&quot;  &quot;</span> + url + <span class=\"string\">&quot; =&gt; 超时&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            LogInfo(resultBuilder.ToString());</span><br><span class=\"line\">            LogInfo(<span class=\"string\">&quot;HTTP检测统计: 成功 &quot;</span> + successCount + <span class=\"string\">&quot;/&quot;</span> + _config.HttpTargets.Count);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">return</span> successCount &gt; <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 快速Ping单个主机</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 优化点：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 1. 使用较短的超时时间(800ms)加快检测速度</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 2. 每次创建新的Ping实例，避免资源竞争</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 3. 简化异常处理，只返回成功/失败</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;host&quot;&gt;</span>目标主机IP地址<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>true表示Ping成功，false表示失败或超时<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> <span class=\"title\">PingHostFast</span>(<span class=\"params\"><span class=\"built_in\">string</span> host</span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">using</span> (<span class=\"keyword\">var</span> ping = <span class=\"keyword\">new</span> Ping())</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 使用较短的超时时间加快检测速度</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> reply = ping.Send(host, <span class=\"number\">800</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> reply != <span class=\"literal\">null</span> &amp;&amp; reply.Status == IPStatus.Success;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span> (Exception)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 发生任何异常都视为失败</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 快速测试HTTP连接</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 技术要点：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 1. 使用HEAD方法，只获取响应头，不下载内容</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 2. 设置较短的超时时间(2000ms)加快检测速度</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 3. 设置合适的User-Agent，避免被某些服务拒绝</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 4. 关闭KeepAlive，避免连接池影响</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;url&quot;&gt;</span>目标URL地址<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>true表示HTTP请求成功，false表示失败或超时<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> <span class=\"title\">TestHttpConnectionFast</span>(<span class=\"params\"><span class=\"built_in\">string</span> url</span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 创建HTTP请求</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> request = WebRequest.Create(url) <span class=\"keyword\">as</span> HttpWebRequest;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (request == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 配置请求参数</span></span><br><span class=\"line\">                request.Timeout = <span class=\"number\">2000</span>;  <span class=\"comment\">// 2秒超时</span></span><br><span class=\"line\">                request.Method = <span class=\"string\">&quot;HEAD&quot;</span>; <span class=\"comment\">// 使用HEAD方法</span></span><br><span class=\"line\">                request.UserAgent = <span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span>;</span><br><span class=\"line\">                request.Accept = <span class=\"string\">&quot;*/*&quot;</span>;</span><br><span class=\"line\">                request.KeepAlive = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 发送请求并获取响应</span></span><br><span class=\"line\">                <span class=\"keyword\">using</span> (<span class=\"keyword\">var</span> response = request.GetResponse() <span class=\"keyword\">as</span> HttpWebResponse)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (response != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 2xx状态码都视为成功</span></span><br><span class=\"line\">                        <span class=\"keyword\">return</span> (<span class=\"built_in\">int</span>)response.StatusCode &gt;= <span class=\"number\">200</span> &amp;&amp; (<span class=\"built_in\">int</span>)response.StatusCode &lt;= <span class=\"number\">299</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span> (WebException ex)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// WebException特殊处理：尝试获取响应状态码</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (ex.Response != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">using</span> (<span class=\"keyword\">var</span> response = ex.Response <span class=\"keyword\">as</span> HttpWebResponse)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (response != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                        &#123;</span><br><span class=\"line\">                            <span class=\"comment\">// 即使发生WebException，如果返回2xx状态码也算成功</span></span><br><span class=\"line\">                            <span class=\"keyword\">return</span> (<span class=\"built_in\">int</span>)response.StatusCode &gt;= <span class=\"number\">200</span> &amp;&amp; (<span class=\"built_in\">int</span>)response.StatusCode &lt;= <span class=\"number\">299</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span> (Exception)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 其他异常都视为失败</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> 用户活动检测</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 检测用户输入活动</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 检测原理：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 1. 通过Windows API获取系统最后输入时间</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 2. 计算当前时间与最后输入时间的差值</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 3. 如果差值小于阈值，则认为用户有活动</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 注意：只检测键盘和鼠标输入活动</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>true表示用户有输入活动，false表示用户空闲<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> <span class=\"title\">HasUserInputActivity</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"built_in\">uint</span> idleTimeMs = GetUserIdleTime();</span><br><span class=\"line\">                <span class=\"built_in\">uint</span> thresholdMs = (<span class=\"built_in\">uint</span>)_config.UserIdleThresholdSeconds * <span class=\"number\">1000</span>;</span><br><span class=\"line\">                <span class=\"built_in\">bool</span> hasActivity = idleTimeMs &lt; thresholdMs;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 记录详细的空闲时间信息</span></span><br><span class=\"line\">                LogInfo(<span class=\"string\">&quot;用户活动检测: &quot;</span> + (hasActivity ? <span class=\"string\">&quot;有活动&quot;</span> : <span class=\"string\">&quot;无活动&quot;</span>) + </span><br><span class=\"line\">                       <span class=\"string\">&quot; (空闲时间: &quot;</span> + (idleTimeMs / <span class=\"number\">1000</span>) + <span class=\"string\">&quot; 秒)&quot;</span>);</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"keyword\">return</span> hasActivity;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span> (Exception ex)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 用户活动检测失败时，默认返回无活动（保守策略）</span></span><br><span class=\"line\">                LogError(<span class=\"string\">&quot;用户活动检测异常&quot;</span>, ex);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 获取用户空闲时间（毫秒）</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 实现方式：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 1. 调用GetLastInputInfo获取系统最后输入时间</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 2. 计算当前系统运行时间与最后输入时间的差值</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 3. 返回用户空闲的毫秒数</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 注意：Environment.TickCount在49.7天后会回绕，但这里影响不大</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>用户空闲时间（毫秒）<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"built_in\">uint</span> <span class=\"title\">GetUserIdleTime</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> lastInputInfo = <span class=\"keyword\">new</span> LASTINPUTINFO();</span><br><span class=\"line\">            lastInputInfo.cbSize = (<span class=\"built_in\">uint</span>)Marshal.SizeOf(lastInputInfo);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> (GetLastInputInfo(<span class=\"keyword\">ref</span> lastInputInfo))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 计算空闲时间 = 当前时间 - 最后输入时间</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> (<span class=\"built_in\">uint</span>)Environment.TickCount - lastInputInfo.dwTime;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// API调用失败时返回最大值，表示用户已长时间空闲</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">uint</span>.MaxValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> 关机操作</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 执行关机操作</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 执行步骤：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 1. 检查管理员权限</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 2. 使用shutdown.exe执行关机命令</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 3. 设置立即关机(/s /f /t 0)</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 参数说明：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> /s: 关机</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> /f: 强制关闭所有应用程序</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> /t 0: 延迟0秒</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">ExecuteShutdown</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                LogWarning(<span class=\"string\">&quot;已达到关机条件，准备执行关机操作&quot;</span>);</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 权限检查：关机需要管理员权限</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!IsRunningAsAdministrator())</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    LogError(<span class=\"string\">&quot;执行关机操作需要管理员权限，请以管理员身份运行本程序&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 配置关机命令参数</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> psi = <span class=\"keyword\">new</span> ProcessStartInfo</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    FileName = <span class=\"string\">&quot;shutdown.exe&quot;</span>,</span><br><span class=\"line\">                    Arguments = <span class=\"string\">&quot;/s /f /t 0&quot;</span>,</span><br><span class=\"line\">                    CreateNoWindow = <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    UseShellExecute = <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 执行关机命令</span></span><br><span class=\"line\">                <span class=\"keyword\">using</span> (<span class=\"keyword\">var</span> process = Process.Start(psi))</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 等待命令执行</span></span><br><span class=\"line\">                    Thread.Sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                </span><br><span class=\"line\">                LogWarning(<span class=\"string\">&quot;关机命令已发送，系统将立即关闭&quot;</span>);</span><br><span class=\"line\">                Stop(); <span class=\"comment\">// 停止程序主循环</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span> (Exception ex)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                LogError(<span class=\"string\">&quot;执行关机操作失败&quot;</span>, ex);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 检查是否以管理员权限运行</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 实现方式：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 1. 获取当前Windows身份标识</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 2. 检查是否属于Administrators组</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 注意：Windows Vista及以上版本需要UAC提升</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>true表示以管理员权限运行，false表示不是管理员<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> <span class=\"title\">IsRunningAsAdministrator</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> identity = System.Security.Principal.WindowsIdentity.GetCurrent();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> principal = <span class=\"keyword\">new</span> System.Security.Principal.WindowsPrincipal(identity);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> principal.IsInRole(System.Security.Principal.WindowsBuiltInRole.Administrator);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 权限检查失败时，默认返回false（保守策略）</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> 日志输出</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 输出程序标题和配置信息</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">PrintBanner</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;===============================================&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;网络空闲关机程序 - NetIdleShutdown&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;版本: 1.0&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;作者: System&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;===============================================&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;功能说明:&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;- 当网络断开且用户无操作时，自动执行关机&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;- 检测策略: 双重检测 (Ping + HTTP)&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;- 检测方式: 并行多线程检测&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;===============================================&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;当前配置:&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;- 无网络关机阈值: &quot;</span> + _config.MaxNoNetMinutes + <span class=\"string\">&quot; 分钟&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;- 检测间隔: &quot;</span> + _config.CheckIntervalSeconds + <span class=\"string\">&quot; 秒&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;- 用户空闲阈值: &quot;</span> + _config.UserIdleThresholdSeconds + <span class=\"string\">&quot; 秒&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;- Ping检测目标: &quot;</span> + _config.PingTargets.Count + <span class=\"string\">&quot; 个&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;- HTTP检测目标: &quot;</span> + _config.HttpTargets.Count + <span class=\"string\">&quot; 个&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;===============================================&quot;</span>);</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 记录信息级别日志</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 用于记录程序正常运行状态信息</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;message&quot;&gt;</span>日志消息<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">LogInfo</span>(<span class=\"params\"><span class=\"built_in\">string</span> message</span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;[&quot;</span> + DateTime.Now.ToString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class=\"string\">&quot;] [INFO] &quot;</span> + message);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 记录警告级别日志</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 用于记录需要注意但不影响程序继续运行的情况</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;message&quot;&gt;</span>日志消息<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">LogWarning</span>(<span class=\"params\"><span class=\"built_in\">string</span> message</span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;[&quot;</span> + DateTime.Now.ToString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class=\"string\">&quot;] [WARN] &quot;</span> + message);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 记录错误级别日志</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 用于记录程序运行中的错误和异常</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;message&quot;&gt;</span>日志消息<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;ex&quot;&gt;</span>异常对象（可选）<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">LogError</span>(<span class=\"params\"><span class=\"built_in\">string</span> message, Exception ex = <span class=\"literal\">null</span></span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;[&quot;</span> + DateTime.Now.ToString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class=\"string\">&quot;] [ERROR] &quot;</span> + message);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ex != <span class=\"literal\">null</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                Console.WriteLine(<span class=\"string\">&quot;[&quot;</span> + DateTime.Now.ToString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class=\"string\">&quot;] [ERROR] 异常类型: &quot;</span> + ex.GetType().Name);</span><br><span class=\"line\">                Console.WriteLine(<span class=\"string\">&quot;[&quot;</span> + DateTime.Now.ToString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class=\"string\">&quot;] [ERROR] 异常消息: &quot;</span> + ex.Message);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">region</span> 资源清理</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 释放程序资源</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 实现IDisposable接口，支持using语句</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Dispose</span>()</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            _isRunning = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            LogInfo(<span class=\"string\">&quot;程序资源已释放&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"keyword\">endregion</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 程序主入口类</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 包含Main方法和程序启动逻辑</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title\">Program</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 应用程序主入口点</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> </span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 主要流程：</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 1. 创建NetIdleShutdown实例</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 2. 设置Ctrl+C中断处理</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 3. 运行网络检测主循环</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> 4. 处理异常并优雅退出</span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;args&quot;&gt;</span>命令行参数（当前版本未使用）<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] <span class=\"keyword\">args</span></span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;[&quot;</span> + DateTime.Now.ToString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class=\"string\">&quot;] [SYSTEM] 程序启动中...&quot;</span>);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">using</span> (<span class=\"keyword\">var</span> shutdown = <span class=\"keyword\">new</span> NetIdleShutdown())</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 设置控制台关闭事件处理（Ctrl+C）</span></span><br><span class=\"line\">                Console.CancelKeyPress += (sender, e) =&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    Console.WriteLine(<span class=\"string\">&quot;[&quot;</span> + DateTime.Now.ToString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class=\"string\">&quot;] [SYSTEM] 收到中断信号，正在停止程序...&quot;</span>);</span><br><span class=\"line\">                    shutdown.Stop();</span><br><span class=\"line\">                    e.Cancel = <span class=\"literal\">true</span>; <span class=\"comment\">// 防止程序立即退出</span></span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"keyword\">try</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    Console.WriteLine(<span class=\"string\">&quot;[&quot;</span> + DateTime.Now.ToString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class=\"string\">&quot;] [SYSTEM] 程序已启动，开始网络监控&quot;</span>);</span><br><span class=\"line\">                    shutdown.Run();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">catch</span> (Exception ex)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    Console.WriteLine(<span class=\"string\">&quot;[&quot;</span> + DateTime.Now.ToString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class=\"string\">&quot;] [SYSTEM] 程序运行失败: &quot;</span> + ex.Message);</span><br><span class=\"line\">                    Environment.Exit(<span class=\"number\">1</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            Console.WriteLine(<span class=\"string\">&quot;[&quot;</span> + DateTime.Now.ToString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>) + <span class=\"string\">&quot;] [SYSTEM] 程序已退出&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>成品 <a href=\"https://github.com/utgnim/NetIdleShutdown.cs/raw/refs/heads/master/NetIdleShutdown.cs\">NetIdleShutdown.cs</a></p>\n<p>3 分钟版 <a href=\"https://github.com/utgnim/NetIdleShutdown.cs/raw/refs/heads/master/3minNetIdleShutdown.exe\">3minNetIdleShutdown.exe</a></p>\n<p>30 分钟版 <a href=\"https://github.com/utgnim/NetIdleShutdown.cs/raw/refs/heads/master/30minNetIdleShutdown.exe\">30minNetIdleShutdown.exe</a></p>\n<p>GitHub地址 <a href=\"https://github.com/utgnim/NetIdleShutdown.cs.git\">https://github.com/utgnim/NetIdleShutdown.cs.git</a></p>\n",
            "tags": [
                "技术"
            ]
        },
        {
            "id": "https://utgnim.github.io/sukebei/%E5%85%B3%E4%BA%8E-Windows-Server-2022-%E5%AE%89%E8%A3%85%E5%9C%A8%E7%AC%94%E8%AE%B0%E6%9C%AC%E4%B8%8A%E4%B8%80%E4%BA%9B%E5%86%85%E5%AE%B9%E6%95%B4%E7%90%86%E5%8F%82%E8%80%83/",
            "url": "https://utgnim.github.io/sukebei/%E5%85%B3%E4%BA%8E-Windows-Server-2022-%E5%AE%89%E8%A3%85%E5%9C%A8%E7%AC%94%E8%AE%B0%E6%9C%AC%E4%B8%8A%E4%B8%80%E4%BA%9B%E5%86%85%E5%AE%B9%E6%95%B4%E7%90%86%E5%8F%82%E8%80%83/",
            "title": "关于 Windows Server 2022 安装在笔记本上一些内容整理参考",
            "date_published": "2025-09-29T12:07:31.000Z",
            "content_html": "<p>近来心血来潮想给笔记本电脑重装系统，遇到的一些问题及解决方案，遂记录汇总；</p>\n<p>前人栽树，后人乘凉，感谢各位大大的帖子指引，帮助很多；</p>\n<p>本方案基于 zh-cn_windows_server_2022_x64_dvd_6c73507d.iso 进行，未在其他系统镜像上进行过测试，因此不保证通用性。</p>\n<h2 id=\"正文\"><a href=\"#正文\" class=\"headerlink\" title=\"正文\"></a>正文</h2><h2 id=\"一、安装\"><a href=\"#一、安装\" class=\"headerlink\" title=\"一、安装\"></a>一、安装</h2><h3 id=\"镜像下载：\"><a href=\"#镜像下载：\" class=\"headerlink\" title=\"镜像下载：\"></a>镜像下载：</h3><p>最初版本：</p>\n<p>BT下载：</p>\n<p>magnet:?xt&#x3D;urn:btih:0A63B2E08D5D154A79D408040BE4994917C223D3&amp;dn&#x3D;zh-cn_windows_server_2022_x64_dvd_6c73507d.iso</p>\n<p>123盘：<a href=\"https://www.123pan.com/s/iBU9jv-zYJNh.html\">https://www.123pan.com/s/iBU9jv-zYJNh.html</a> （123盘电脑浏览器解除限速下载限制，可使用油猴脚本 <a href=\"https://github.com/hmjz100/LinkSwift\">https://github.com/hmjz100/LinkSwift</a> ）</p>\n<p>Windows Server 2022 (x64) - DVD (Chinese-Simplified)</p>\n<p>文件：zh-cn_windows_server_2022_x64_dvd_6c73507d.iso</p>\n<p>大小：5.41GB</p>\n<p>MD5：A93A5845D924F99ADEC1432A5D69103B</p>\n<p>SHA1：0DF46441DD01F99459FB75BDB732E7904900A0D7</p>\n<p>SHA256：E77BB4618182D1E5D0B39DA7E72354F4167EBB859428E7482587DD5A2A72F599</p>\n<p>资源来自：</p>\n<p><a href=\"https://next.itellyou.cn/\">https://next.itellyou.cn/</a></p>\n<p><a href=\"https://hellowindows.cn/\">https://hellowindows.cn/</a></p>\n<p>最新版本可在远景论坛内各大大发布的资源贴内下载</p>\n<h2 id=\"二、调整优化\"><a href=\"#二、调整优化\" class=\"headerlink\" title=\"二、调整优化\"></a>二、调整优化</h2><p>具体操作步骤大致如下：</p>\n<ol>\n<li>全新安装 Windows 10 或 Windows 11，安装全部驱动，确保各功能（触控板、指纹等）可正常使用</li>\n<li>使用 Dism++ [ <a href=\"https://github.com/Chuyu-Team/Dism-Multi-language/releases\">https://github.com/Chuyu-Team/Dism-Multi-language/releases</a> ] 中的 驱动管理 导出驱动（不要勾选 显示适配器，也即显卡的驱动）到非系统盘中的任意文件夹中（以下将该目录称为【驱动备份目录】）</li>\n<li>下载帖子 分享国外大神提供的Server 2022 蓝牙HID驱动，解决蓝牙外设能配对不能连接的问题 [ <a href=\"https://bbs.pcbeta.com/viewthread-1942811-1-1.html\">https://bbs.pcbeta.com/viewthread-1942811-1-1.html</a> ] 中的附件【Bluetooth_HID.zip 】，解压到上面的的【驱动备份目录】中</li>\n<li>解压下载的 zh-cn_windows_server_2022_x64_dvd_6c73507d.iso 镜像文件到一个目录（下称【镜像目录】），使用 Dism++ 挂载该目录下的 install.wim ，目标镜像 记得选择带图形化界面的（比如 Windows Server 2022 Standard (Desktop Experience) 或者 Windows Server 2022 Datacenter (Desktop Experience)）</li>\n<li>使用 Dism++ 中的 驱动管理 功能中的 添加驱动【驱动备份目录】中的驱动到挂载的镜像中，然后 保存镜像 选择 增量保存，最后 卸载镜像</li>\n<li>通过 微PE 等 PE 系统 或者直接启动【镜像目录】中的镜像 安装修改后的镜像</li>\n<li>参考帖子 Server 2022 改造为个人工作站系统的调整和优化 [ <a href=\"https://bbs.pcbeta.com/viewthread-1911508-1-1.html\">https://bbs.pcbeta.com/viewthread-1911508-1-1.html</a> ] 中的内容进行调整</li>\n</ol>\n<h2 id=\"三、驱动问题\"><a href=\"#三、驱动问题\" class=\"headerlink\" title=\"三、驱动问题\"></a>三、驱动问题</h2><p>到这一步 触控板 和 指纹 还无法使用</p>\n<p>『可能还有 蓝牙音频驱动 无法解决，但由于本人没有蓝牙音频设备，无法进行测试，仅提供解决方法指引 让server 2022 支持蓝牙耳机的方法，测试可用，请用V3附件 [ <a href=\"https://bbs.pcbeta.com/viewthread-1930349-1-1.html\">https://bbs.pcbeta.com/viewthread-1930349-1-1.html</a> ]』</p>\n<h3 id=\"触控板解决方案（自签名思路，无需开启测试模式即可加载驱动）\"><a href=\"#触控板解决方案（自签名思路，无需开启测试模式即可加载驱动）\" class=\"headerlink\" title=\"触控板解决方案（自签名思路，无需开启测试模式即可加载驱动）\"></a>触控板解决方案（自签名思路，无需开启测试模式即可加载驱动）</h3><ol>\n<li>使用 7z 打开【镜像目录】中的 \\sources\\boot.wim ，提取  \\1\\Windows\\INF 中的 hidi2c.inf 文件和 \\1\\Windows\\System32\\drivers 中的 hidi2c.sys 文件到一个目录中（下称【触控板驱动】）</li>\n<li>参考 [<a href=\"https://github.com/PIKACHUIM/FakeSign]\">https://github.com/PIKACHUIM/FakeSign]</a> 进行签名<br>• 需要安装时间证书信任工具 [ <a href=\"https://github.com/PIKACHUIM/FakeSign/raw/refs/heads/main/Releases/PikachuTestCert.exe\">https://github.com/PIKACHUIM/FakeSign/raw/refs/heads/main/Releases/PikachuTestCert.exe</a> ]<br>• 需要安装 WDK [ <a href=\"https://learn.microsoft.com/zh-cn/windows-hardware/drivers/download-the-wdk\">https://learn.microsoft.com/zh-cn/windows-hardware/drivers/download-the-wdk</a> ]，并根据安装目录自行设置环境变量，如 C:\\Program Files (x86)\\Windows Kits\\10\\bin\\10.0.***.0\\x86，确保 inf2cat.exe 能被 cmd 直接调用<br>• 但是中间会出现问题，不允许把系统文件“重新打包”进驱动目录的错误，需要改 hidi2c.inf 安装  hidi2c.sys  驱动为绑定 hidi2c.sys 驱动，于是请 Microsoft Copilot 写了一个针对自己设备 硬件ID 的 hidi2c-elan-bind.inf 文件，利用该方法签名，安装后，触控板即恢复正常</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; hidi2c-elan-bind.inf</span><br><span class=\"line\">; Bind ELAN2203 I2C HID devices to the in-box Microsoft hidi2c.sys without redistributing binaries.</span><br><span class=\"line\"></span><br><span class=\"line\">[Version]</span><br><span class=\"line\">Signature   = &quot;$Windows NT$&quot;</span><br><span class=\"line\">Class       = HIDClass</span><br><span class=\"line\">ClassGuid   = &#123;745a17a0-74d3-11d0-b6fe-00a0c90f57da&#125;</span><br><span class=\"line\">Provider    = %MSFT%</span><br><span class=\"line\">DriverVer = 01/01/2015,1.0.1.0</span><br><span class=\"line\">CatalogFile = hidi2c_elan_bind.cat</span><br><span class=\"line\"></span><br><span class=\"line\">[ControlFlags]</span><br><span class=\"line\">ExcludeFromSelect = *</span><br><span class=\"line\"></span><br><span class=\"line\">[Manufacturer]</span><br><span class=\"line\">%MSFT% = Microsoft, NTx86, NTamd64</span><br><span class=\"line\"></span><br><span class=\"line\">[Microsoft.NTx86]</span><br><span class=\"line\">%ELAN.DeviceDesc% = hidi2c.Bind.Install, ACPI\\VEN_ELAN&amp;DEV_2203</span><br><span class=\"line\">%ELAN.DeviceDesc% = hidi2c.Bind.Install, ACPI\\ELAN2203</span><br><span class=\"line\">%ELAN.DeviceDesc% = hidi2c.Bind.Install, *ELAN2203</span><br><span class=\"line\"></span><br><span class=\"line\">[Microsoft.NTamd64]</span><br><span class=\"line\">%ELAN.DeviceDesc% = hidi2c.Bind.Install, ACPI\\VEN_ELAN&amp;DEV_2203</span><br><span class=\"line\">%ELAN.DeviceDesc% = hidi2c.Bind.Install, ACPI\\ELAN2203</span><br><span class=\"line\">%ELAN.DeviceDesc% = hidi2c.Bind.Install, *ELAN2203</span><br><span class=\"line\"></span><br><span class=\"line\">; Bind to the in-box hidi2c installation logic (no CopyFiles, no ServiceBinary)</span><br><span class=\"line\">[hidi2c.Bind.Install]</span><br><span class=\"line\">Include = hidi2c.inf</span><br><span class=\"line\">Needs   = hidi2c_Device.NT</span><br><span class=\"line\"></span><br><span class=\"line\">[hidi2c.Bind.Install.HW]</span><br><span class=\"line\">Include = hidi2c.inf</span><br><span class=\"line\">Needs   = hidi2c_Device.NT.HW</span><br><span class=\"line\">AddReg  = hidi2c_Device.Configuration.AddReg.Override</span><br><span class=\"line\"></span><br><span class=\"line\">[hidi2c.Bind.Install.Services]</span><br><span class=\"line\">Include = hidi2c.inf</span><br><span class=\"line\">Needs   = hidi2c_Device.NT.Services</span><br><span class=\"line\"></span><br><span class=\"line\">; Optional: override/append device configuration values (safe per-device HKR writes)</span><br><span class=\"line\">[hidi2c_Device.Configuration.AddReg.Override]</span><br><span class=\"line\">HKR,,&quot;EnhancedPowerManagementEnabled&quot;,0x00010001,1</span><br><span class=\"line\">HKR,,&quot;DeviceResetNotificationEnabled&quot;,0x00010001,1</span><br><span class=\"line\">HKR,,&quot;LegacyTouchScaling&quot;,0x00010001,0</span><br><span class=\"line\"></span><br><span class=\"line\">[Strings]</span><br><span class=\"line\">MSFT             = &quot;Microsoft&quot;</span><br><span class=\"line\">ELAN.DeviceDesc  = &quot;ELAN I2C HID Device (Bind to in-box hidi2c)&quot;</span><br></pre></td></tr></table></figure>\n\n\n<p>特别注意</p>\n<p>提供的文件不能直接使用，需要 更改为 你自己的设备 硬件ID，然后重新签名；</p>\n<p>微软有一个黑名单会禁止使用这些签名用的泄露的证书，如果你系统里的 黑名单 中有为驱动签名的证书，那可能就无法使用该方法了；</p>\n<p>有帖子 windows10及以上本地驱动加载黑名单查看 [ <a href=\"https://bbs.kanxue.com/thread-273316.htm\">https://bbs.kanxue.com/thread-273316.htm</a> ] 提供有修改该黑名单的方法，但本人没有验证过，无法确定更改后是否即可恢复正常；</p>\n<p>如果你信任我，也可以发 硬件ID 和 驱动文件 给我，我可以帮你签。当然“我不能保证这个文件一定能工作，也不能保证它不会损坏你的计算机，你将需要自行承担可能存在的风险。”</p>\n<p>参考资料<br>Windows Server 2019&#x2F;2022 i2c 触摸屏&#x2F;触摸板无法使用的解决方法 [ <a href=\"https://www.bilibili.com/opus/884213704738996247\">https://www.bilibili.com/opus/884213704738996247</a> ]</p>\n<hr>\n<h3 id=\"指纹解决方案（通过替换-CredentialEnrollmentManager-exe-解锁）\"><a href=\"#指纹解决方案（通过替换-CredentialEnrollmentManager-exe-解锁）\" class=\"headerlink\" title=\"指纹解决方案（通过替换 CredentialEnrollmentManager.exe 解锁）\"></a>指纹解决方案（通过替换 CredentialEnrollmentManager.exe 解锁）</h3><p>参考 给 Windows Server 2022 配置 Windows Hello 指纹解锁 [ <a href=\"https://afa31148-4a8c-4113-a92f-72626cd2a27b.x.wtf/2021/fingerprint-unlocking-for-windows-server-2022/\">https://afa31148-4a8c-4113-a92f-72626cd2a27b.x.wtf/2021/fingerprint-unlocking-for-windows-server-2022/</a> ]</p>\n<p>下面是请 Copilot 写的的替换命令，需要用到工具 NSudo [ <a href=\"https://github.com/M2TeamArchived/NSudo/releases\">https://github.com/M2TeamArchived/NSudo/releases</a> ]</p>\n<figure class=\"highlight bat\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">REM === 使用 NSudo 打开 TrustedInstaller 权限的命令行后，逐行执行以下命令 ===</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">REM Step 1: 备份原始文件和 ACL</span></span><br><span class=\"line\">takeown /f &quot;C:\\Windows\\System32\\CredentialEnrollmentManager.exe&quot;</span><br><span class=\"line\">icacls &quot;C:\\Windows\\System32\\CredentialEnrollmentManager.exe&quot; /save &quot;D:\\backup\\CredentialEnrollmentManager_acl.txt&quot;</span><br><span class=\"line\"><span class=\"built_in\">copy</span> &quot;C:\\Windows\\System32\\CredentialEnrollmentManager.exe&quot; &quot;D:\\backup\\CredentialEnrollmentManager.exe&quot;</span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">REM Step 2: 替换为自定义文件</span></span><br><span class=\"line\"><span class=\"built_in\">copy</span> /Y &quot;D:\\..你下载文件保存的目录..\\CredentialEnrollmentManager.exe&quot; &quot;C:\\Windows\\System32\\CredentialEnrollmentManager.exe&quot;</span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">REM Step 3: 恢复原始 ACL 权限</span></span><br><span class=\"line\">icacls &quot;C:\\Windows\\System32&quot; /<span class=\"built_in\">restore</span> &quot;D:\\backup\\CredentialEnrollmentManager_acl.txt&quot;</span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">REM Step 4: 可选 - 设置只读属性，防止更新覆盖</span></span><br><span class=\"line\"><span class=\"built_in\">attrib</span> +R &quot;C:\\Windows\\System32\\CredentialEnrollmentManager.exe&quot;</span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">REM Step 5: 可选 - 拒绝 TrustedInstaller 写入（需谨慎）</span></span><br><span class=\"line\">icacls &quot;C:\\Windows\\System32\\CredentialEnrollmentManager.exe&quot; /deny &quot;NT SERVICE\\TrustedInstaller&quot;:(W)</span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">REM === 回滚方法（如需恢复原始文件） ===</span></span><br><span class=\"line\"><span class=\"built_in\">copy</span> /Y &quot;D:\\backup\\CredentialEnrollmentManager.exe&quot; &quot;C:\\Windows\\System32\\CredentialEnrollmentManager.exe&quot;</span><br><span class=\"line\">icacls &quot;C:\\Windows\\System32&quot; /<span class=\"built_in\">restore</span> &quot;D:\\backup\\CredentialEnrollmentManager_acl.txt&quot;</span><br><span class=\"line\"><span class=\"built_in\">attrib</span> -R &quot;C:\\Windows\\System32\\CredentialEnrollmentManager.exe&quot;</span><br></pre></td></tr></table></figure>\n\n<p>然后你需要新建一个用户，切换到该用户才能使用指纹，但是这样一来就需要重新调整设置，不太优雅；</p>\n<p>因此我推荐使用 Forensit [ <a href=\"https://www.forensit.com/downloads.html\">https://www.forensit.com/downloads.html</a> ] 里的 User Profile Wizard Release 24 [ <a href=\"https://www.forensit.com/Downloads/Profwiz.msi\">https://www.forensit.com/Downloads/Profwiz.msi</a> ]，该工具可以直接将当前 Administrator 的用户配置迁移到 其他用户 下；</p>\n<p>需要注意的一点是新建用户后不注销，直接使用该工具迁移，似乎可以直接使用 C:\\Users\\Administrator 作为新用户的目录来使用，但我不确定这样操作是否正确，有没有隐患</p>\n<h2 id=\"四、其它可能用到的工具：\"><a href=\"#四、其它可能用到的工具：\" class=\"headerlink\" title=\"四、其它可能用到的工具：\"></a>四、其它可能用到的工具：</h2><p>Microsoft Activation Scripts (MAS): [ <a href=\"https://massgrave.dev/\">https://massgrave.dev/</a> ]</p>\n<p>Microsoft Defender &amp; Windows Update 开关 [ <a href=\"https://bbs.pcbeta.com/viewthread-1913968-1-1.html\">https://bbs.pcbeta.com/viewthread-1913968-1-1.html</a> ]</p>\n<p>微软常用运行库合集_By:Dreamcast [ <a href=\"https://wwa.lanzout.com/b0b8rs19a#9527\">https://wwa.lanzout.com/b0b8rs19a#9527</a> ]</p>\n<p>至此，安装结束！</p>\n<p>二〇二五年九月二十九日夜</p>\n<p>补充</p>\n<p>关于 蓝牙音频驱动 这个似乎可以用，但不清楚是否和系统自己带的  个人局域网服务  有什么区别，装上就没有叹号了，但我没有蓝牙音频设备无法测试设备是否可以正常连接使用，驱动程序提供商是 Broadcom</p>\n<p>下载来源：[ <a href=\"https://geek-speak.ru/download/driver-ms_bthpan/\">https://geek-speak.ru/download/driver-ms_bthpan/</a> ]</p>\n<p>病毒检测：[ <a href=\"https://www.virustotal.com/gui/file/82f5fda2dcb57419413b7a7284ce6e3c1b1049f43a44245e5e22e010fb73b34f\">https://www.virustotal.com/gui/file/82f5fda2dcb57419413b7a7284ce6e3c1b1049f43a44245e5e22e010fb73b34f</a> ]</p>\n<p>另外有个一劳永逸的方法，不用需要费力给驱动签名消除叹号，相当于每次开机默认以  关闭驱动程序强制验证  选项开机，缺点就是每次开机，开机界面都会有一堆命令显示</p>\n<p>纠正，需要每次开机重新执行一遍 EfiDSEFix.exe -d 才行，可以结合 任务计划程序 设置开机自动运行，并且加上  禁用  启用  没有数字签名的设备命令，需要用到 WDK 里的 devcon.exe</p>\n<p>项目地址：[ <a href=\"https://github.com/Mattiwatti/EfiGuard\">https://github.com/Mattiwatti/EfiGuard</a> ] （在 [ <a href=\"https://github.com/PIKACHUIM/FakeSign/issues/9\">https://github.com/PIKACHUIM/FakeSign/issues/9</a> ] 这里了解到该项目）</p>\n<p>使用的前提条件是  内存完整性（HVCI）为关闭状态</p>\n<p>步骤如下：</p>\n<ol>\n<li><p>下载 [ <a href=\"https://github.com/Mattiwatti/EfiGuard/releases/download/v1.4/EfiGuard-v1.4.zip\">https://github.com/Mattiwatti/EfiGuard/releases/download/v1.4/EfiGuard-v1.4.zip</a> ]，解压到任意目录（下称【EfiGuard 目录】 ），不要删除</p>\n</li>\n<li><p>使用 DiskGenius 或其他工具，将  EfiGuardDxe.efi  Loader.efi  两个文件复制到  \\EFI\\Boot 下面</p>\n</li>\n<li><p>配合 EasyUEFI 新建启动项，并设置为 Loader.efi ，然后将新建的启动项调整为首位，重启后界面会有命令执行过程显示</p>\n</li>\n<li><p>开机后，以管理员身份运行 命令行窗口，切换到【EfiGuard 目录】 执行 EfiDSEFix.exe -d ，就会禁用 Driver Signature Enforcement（驱动程序签名强制）</p>\n</li>\n</ol>\n<p>此时再安装没有经过微软签名的驱动，也不会有叹号出现了</p>\n<p>由于关闭了 驱动程序强制验证，以后安装程序要谨慎一点，否则电脑很容易中招</p>\n",
            "tags": [
                "技术"
            ]
        },
        {
            "id": "https://utgnim.github.io/sukebei/%E6%90%AD%E5%BB%BA-Hexo-%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/",
            "url": "https://utgnim.github.io/sukebei/%E6%90%AD%E5%BB%BA-Hexo-%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/",
            "title": "搭建 Hexo 静态博客参考资料",
            "date_published": "2025-07-13T12:59:46.000Z",
            "content_html": "<h4 id=\"Hexo-官方文档\"><a href=\"#Hexo-官方文档\" class=\"headerlink\" title=\"Hexo 官方文档\"></a>Hexo 官方文档</h4><p> <a href=\"https://hexo.io/zh-cn/docs/\">https://hexo.io/zh-cn/docs/</a></p>\n<h4 id=\"Hexo-主题\"><a href=\"#Hexo-主题\" class=\"headerlink\" title=\"Hexo 主题\"></a>Hexo 主题</h4><p> ​<a href=\"https://github.com/tufu9441/maupassant-hexo\">maupassant-hexo</a><br> <a href=\"https://www.haomwei.com/technology/maupassant-hexo.html\">maupassant-hexo 中文文档</a><br> <a href=\"https://github.com/bakasine/gal-theme\">gal-theme</a></p>\n<h4 id=\"Hexo-双主题教程\"><a href=\"#Hexo-双主题教程\" class=\"headerlink\" title=\"Hexo 双主题教程\"></a>Hexo 双主题教程</h4><p> <a href=\"https://immortalqx.github.io/2022/04/17/hexo-multi-theme/\">Hexo 中同时使用多个主题</a>    主要参考了这个；<br> <a href=\"https://www.hozen.site/archives/67/\">Hexo 的多主题自动化部署</a>    这个只能看懂一部分，我果然还是太菜了！</p>\n<h4 id=\"Markdown-教程\"><a href=\"#Markdown-教程\" class=\"headerlink\" title=\"Markdown 教程\"></a>Markdown 教程</h4><p> <a href=\"https://www.runoob.com/markdown/md-tutorial.html\">菜鸟教程 - Markdown 教程</a></p>\n",
            "tags": [
                "技术"
            ]
        }
    ]
}